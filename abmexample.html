

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example &mdash; ActivitySim 0.9.5 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ActivitySim
          

          
          </a>

          
            
            
              <div class="version">
                0.9.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-model-design">Example Model Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#space">Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decision-making-units">Decision-making units</a></li>
<li class="toctree-l3"><a class="reference internal" href="#person-type-segmentation">Person type segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activity-type-segmentation">Activity type segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#treatment-of-time">Treatment of time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trip-modes">Trip modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sub-models">Sub-models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#folder-and-file-setup">Folder and File Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inputs">Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sub-model-specification-files">Sub-Model Specification Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chunk-size">Chunk size</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline">Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-mtc-example">Running the MTC Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multiprocessing">Multiprocessing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#outputs">Outputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tracing">Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-logsums">Writing Logsums</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#estimation">Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workflow">Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estimation-example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#settings">Settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="howitworks.html">How the System Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Software Development</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ActivitySim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/abmexample.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example">
<span id="id1"></span><h1>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<p>This page describes the example model design, how to setup and run the example, how to review outputs, and
how to re-estimate submodels. The default configuration of the example is limited to a small sample of
households and zones so that it can be run quickly and require less than 1 GB of RAM.  The full scale example
can be configured and run as well.</p>
<span class="target" id="index-0"></span><div class="section" id="example-model-design">
<span id="index-1"></span><h2>Example Model Design<a class="headerlink" href="#example-model-design" title="Permalink to this headline">¶</a></h2>
<p>The example AB model implemented with the activitysim framework is
<a class="reference external" href="https://github.com/BayAreaMetro/travel-model-one">Bay Area Metro Travel Model One</a> (TM1).
TM1 has its roots in a wide array of analytical approaches, including discrete
choice forms (multinomial and nested logit models), activity duration models, time-use models,
models of individual micro-simulation with constraints, entropy-maximization models, etc.
These tools are combined in the model design to realistically represent travel behavior,
adequately replicate observed activity-travel patterns, and ensure model sensitivity to
infrastructure and policies. The model is implemented in a micro-simulation framework. Microsimulation
methods capture aggregate outcomes through the representation of the behavior of
individual decision-makers.</p>
<div class="section" id="space">
<h3>Space<a class="headerlink" href="#space" title="Permalink to this headline">¶</a></h3>
<p>TM1 uses the 1454-zone system developed for the MTC trip-based model.  The zones are fairly large for the region,
which may somewhat distort the representation of transit access in mode choice. To ameliorate this problem, the
original model zones were further sub-divided into three categories of transit access: short walk, long walk, and not
walkable.  However, support for transit subzones is not included in the activitysim implementation since the latest generation
of activity-based models typically use an improved approach to spatial representation called multiple zone systems.</p>
<p>In brief, under a multiple zone system approach, all households are assigned to microzones (which are smaller than traditional
TAZs) and trips are assigned to origin and destination microzones.  When considering network level-of-service (LOS) indicators,
the model uses different spatial resolutions for different travel modes.  For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>TAZs are used for auto network modeling and a set of taz-to-taz skims is input to the demand model</p></li>
<li><p>Microzones are used for nearby non-motorized mode (walk and bike) network modeling and skims and a set of nearby maz-to-maz skims is input to the demand model</p></li>
<li><p>Transit access points (TAPs) (or transit catchment areas) are used for transit network modeling and skims and a set of tap-to-tap skims is input to the demand model</p></li>
<li><p>Microzone to transit access point for transit access/egress LOS is input to the demand model</p></li>
</ul>
</div></blockquote>
<p>Since trips are modeled in the demand model from microzone to microzone, but transit network LOS is split across
two input data sets, transit virtual path building (TVPB) is done to generate LOS measures from:</p>
<blockquote>
<div><ul class="simple">
<li><p>the trip origin microzone to a select number of nearby TAPs using microzone to TAP LOS measures</p></li>
<li><p>boarding TAP to alighting TAP LOS measures (TAP to TAP skims)</p></li>
<li><p>alighting TAP to destination microzone using microzone to TAP LOS measures</p></li>
</ul>
</div></blockquote>
<p>The resulting complete transit path LOS for the best, or a bundle of, paths is then used in the demand model
for representing transit LOS at the microzone level.</p>
<p>Support for multiple zone systems is <strong>NOT YET IMPLEMENTED</strong>, but planned for the next release.  For the time being,
all travel is modeled at the TAZ level.</p>
</div>
<div class="section" id="decision-making-units">
<h3>Decision-making units<a class="headerlink" href="#decision-making-units" title="Permalink to this headline">¶</a></h3>
<p>Decision-makers in the model system are households and persons. These decision-makers are
created for each simulation year based on a population synthesis process such as
<a class="reference external" href="https://github.com/ActivitySim/PopulationSim">PopulationSim</a>. The decision-makers are used in the
subsequent discrete-choice models to select a single alternative from a list of available
alternatives according to a probability distribution. The probability distribution is generated
from various logit-form models which take into account the attributes of the decision-maker and
the attributes of the various alternatives. The decision-making unit is an important element of
model estimation and implementation, and is explicitly identified for each model.</p>
</div>
<div class="section" id="person-type-segmentation">
<h3>Person type segmentation<a class="headerlink" href="#person-type-segmentation" title="Permalink to this headline">¶</a></h3>
<p>TM1 is implemented in a micro-simulation framework. A key advantage of the
micro-simulation approach is that there are essentially no computational constraints on the
number of explanatory variables which can be included in a model specification. However, even
with this flexibility, the model system includes some segmentation of decision-makers.
Segmentation is a useful tool both to structure models and also as a way to characterize person
roles within a household.</p>
<p>The person types shown below are used for the example model. The person types are mutually exclusive
with respect to age, work status, and school status.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 58%" />
<col style="width: 9%" />
<col style="width: 18%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Person Type</p></th>
<th class="head"><p>Age</p></th>
<th class="head"><p>Work Status</p></th>
<th class="head"><p>School Status</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Full-time worker (30+ hours a week)</p></td>
<td><p>18+</p></td>
<td><p>Full-time</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Part-time worker (&lt;30 hours but works on a regular basis)</p></td>
<td><p>18+</p></td>
<td><p>Part-time</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Non-working adult</p></td>
<td><p>18 - 64</p></td>
<td><p>Unemployed</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>Retired person</p></td>
<td><p>65+</p></td>
<td><p>Unemployed</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>College student</p></td>
<td><p>18+</p></td>
<td><p>Any</p></td>
<td><p>College</p></td>
</tr>
<tr class="row-odd"><td><p>Driving age student</p></td>
<td><p>16 - 17</p></td>
<td><p>Any</p></td>
<td><p>Pre-college</p></td>
</tr>
<tr class="row-even"><td><p>Non-driving student</p></td>
<td><p>6 - 16</p></td>
<td><p>None</p></td>
<td><p>Pre-college</p></td>
</tr>
<tr class="row-odd"><td><p>Pre-school child</p></td>
<td><p>0 - 5</p></td>
<td><p>None</p></td>
<td><p>Preschool</p></td>
</tr>
</tbody>
</table>
<p>Household type segments are useful for pre-defining certain data items (such as destination
choice size terms) so that these data items can be pre-calculated for each segment. Precalculation
of these data items reduces model complexity and runtime. The segmentation is based on household income,
and includes four segments - low, medium, high, very high.</p>
<p>In the model, the persons in each household are assigned a simulated but fixed value of time
that modulates the relative weight the decision-maker places on time and cost. The probability
distribution from which the value of time is sampled was derived from a toll choice model
estimated using data from a stated preference survey performed for the SFCTA Mobility, Access, and
Pricing Study, and is a lognormal distribution with a mean that varies by income segment.</p>
</div>
<div class="section" id="activity-type-segmentation">
<h3>Activity type segmentation<a class="headerlink" href="#activity-type-segmentation" title="Permalink to this headline">¶</a></h3>
<p>The activity types are used in most model system components, from developing daily activity patterns
and to predicting tour and trip destinations and modes by purpose.  The set of activity types is shown below.
The activity types are also grouped according to whether the activity is mandatory or non-mandatory and
eligibility requirements are assigned determining which person-types can be used for generating each
activity type. The classification scheme of each activity type reflects the relative importance or
natural hierarchy of the activity, where work and school activities are typically the most inflexible
in terms of generation, scheduling and location, and discretionary activities are typically the most
flexible on each of these dimensions. Each out-of-home location that a person travels to in the
simulation is assigned one of these activity types.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 50%" />
<col style="width: 10%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Purpose</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>Eligibility</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Work</p></td>
<td><p>Working at regular workplace or work-related activities outside the home</p></td>
<td><p>Mandatory</p></td>
<td><p>Workers and students</p></td>
</tr>
<tr class="row-odd"><td><p>University</p></td>
<td><p>College or university</p></td>
<td><p>Mandatory</p></td>
<td><p>Age 18+</p></td>
</tr>
<tr class="row-even"><td><p>High School</p></td>
<td><p>Grades 9-12</p></td>
<td><p>Mandatory</p></td>
<td><p>Age 14-17</p></td>
</tr>
<tr class="row-odd"><td><p>Grade School</p></td>
<td><p>Grades preschool, K-8</p></td>
<td><p>Mandatory</p></td>
<td><p>Age 0-13</p></td>
</tr>
<tr class="row-even"><td><p>Escorting</p></td>
<td><p>Pick-up/drop-off passengers (auto trips only)</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 16+</p></td>
</tr>
<tr class="row-odd"><td><p>Shopping</p></td>
<td><p>Shopping away from home</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 5+ (if joint travel, all persons)</p></td>
</tr>
<tr class="row-even"><td><p>Other Maintenance</p></td>
<td><p>Personal business/services and medical appointments</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 5+ (if joint travel, all persons)</p></td>
</tr>
<tr class="row-odd"><td><p>Social/Recreational</p></td>
<td><p>Recreation, visiting friends/family</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 5+ (if joint travel, all persons)</p></td>
</tr>
<tr class="row-even"><td><p>Eat Out</p></td>
<td><p>Eating outside of home</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 5+ (if joint travel, all persons)</p></td>
</tr>
<tr class="row-odd"><td><p>Other Discretionary</p></td>
<td><p>Volunteer work, religious activities</p></td>
<td><p>NonMandatory</p></td>
<td><p>Age 5+ (if joint travel, all persons)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="treatment-of-time">
<h3>Treatment of time<a class="headerlink" href="#treatment-of-time" title="Permalink to this headline">¶</a></h3>
<p>The TM1 example model system functions at a temporal resolution of one hour. These one hour increments
begin with 3 AM and end with 3 AM the next day. Temporal integrity is ensured so that no
activities are scheduled with conflicting time windows, with the exception of short
activities/tours that are completed within a one hour increment. For example, a person may have
a short tour that begins and ends within the 8 AM to 9 AM period, as well as a second longer tour
that begins within this time period, but ends later in the day.</p>
<p>A critical aspect of the model system is the relationship between the temporal resolution used for
scheduling activities and the temporal resolution of the network assignment periods. Although
each activity generated by the model system is identified with a start time and end time in one hour
increments, LOS matrices are only created for five aggregate time periods. The trips occurring in each time period
reference the appropriate transport network depending on their trip mode and the mid-point trip
time. The definition of time periods for LOS matrices is given below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 32%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Time Period</p></th>
<th class="head"><p>Start Hour</p></th>
<th class="head"><p>End Hour</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EA</p></td>
<td><p>3</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>AM</p></td>
<td><p>6</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>MD</p></td>
<td><p>11</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-odd"><td><p>PM</p></td>
<td><p>15</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p>EV</p></td>
<td><p>20</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="trip-modes">
<h3>Trip modes<a class="headerlink" href="#trip-modes" title="Permalink to this headline">¶</a></h3>
<p>The trip modes defined in the example model are below. The modes include auto by
occupancy and toll/non-toll choice, walk and bike, walk and drive access to five different
transit line-haul modes, and ride hail with taxi, single TNC (Transportation Network Company), and shared TNC.</p>
<blockquote>
<div><ul class="simple">
<li><p>Auto</p>
<ul>
<li><p>SOV Free</p></li>
<li><p>SOV Pay</p></li>
<li><p>2 Person Free</p></li>
<li><p>2 Person Pay</p></li>
<li><p>3+ Person Free</p></li>
<li><p>3+ Person Pay</p></li>
</ul>
</li>
<li><p>Nonmotorized</p>
<ul>
<li><p>Walk</p></li>
<li><p>Bike</p></li>
</ul>
</li>
<li><p>Transit</p>
<ul>
<li><p>Walk</p>
<ul>
<li><p>Walk to Local Bus</p></li>
<li><p>Walk to Light-Rail Transit</p></li>
<li><p>Walk to Express Bus</p></li>
<li><p>Walk to Bus Rapid Transit</p></li>
<li><p>Walk to Heavy Rail</p></li>
</ul>
</li>
<li><p>Drive</p>
<ul>
<li><p>Drive to Local Bus</p></li>
<li><p>Drive to Light-Rail Transit</p></li>
<li><p>Drive to Express Bus</p></li>
<li><p>Drive to Bus Rapid Transit</p></li>
<li><p>Drive to Heavy Rail</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Ride Hail</p>
<ul>
<li><p>Taxi</p></li>
<li><p>Single TNC</p></li>
<li><p>Shared TNC</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="sub-models">
<h3>Sub-models<a class="headerlink" href="#sub-models" title="Permalink to this headline">¶</a></h3>
<p>The general design of the example model is presented below.  Long-term choices that relate to
the usual workplace/university/school for each worker and student, household car ownership, and the
availability of free parking at workplaces are first.</p>
<p>The coordinated daily activity pattern type of each household member is the first travel-related
sub-model in the hierarchy. This model classifies daily patterns by three types:</p>
<blockquote>
<div><ul class="simple">
<li><p>Mandatory, which includes at least one out-of-home mandatory activity (work or school)</p></li>
<li><p>Non-mandatory, which includes at least one out-of-home non-mandatory activity, but does not include out-of-home mandatory activities</p></li>
<li><p>Home, which does not include any out-of-home activity or travel</p></li>
</ul>
</div></blockquote>
<p>The pattern type sub-model leaves open the frequency of tours for mandatory and nonmandatory
purposes since these sub-models are applied later in the model sequence. Daily
pattern-type choices of the household members are linked in such a way that decisions made by
members are reflected in the decisions made by the other members.</p>
<p>After the frequency and time-of-day for work and school tours are determined, the
next major model component relates to joint household travel. This component produces a
number of joint tours by travel purpose for the entire household, travel party composition
in terms of adults and children, and then defines the participation of each household
member in each joint household tour. It is followed by choice of destination and time-ofday.</p>
<p>The next stage relates to maintenance and discretionary tours that are modeled at the individual
person level. The models include tour frequency, choice of destination and time
of day. Next, a set of sub-models relate tour-level details on mode, exact number of
intermediate stops on each half-tour and stop location. It is followed by the last set of
sub-models that add details for each trip including trip departure time, trip mode details and parking
location for auto trips.</p>
<img alt="_images/abmexample.jpg" src="_images/abmexample.jpg" usemap="#image-map" />

   <map name="image-map">
    <area target="" alt="" title="" href="models.html#write-trip-matrices" coords="234,683,436,709" shape="rect">
    <area target="" alt="" title="" href="models.html#trip-mode-choice" coords="438,670,235,646" shape="rect">
    <area target="" alt="" title="" href="models.html#trip-scheduling" coords="235,607,434,630" shape="rect">
    <area target="" alt="" title="" href="models.html#trip-destination-choice" coords="235,565,433,588" shape="rect">
    <area target="" alt="" title="" href="models.html#trip-purpose" coords="236,524,436,550" shape="rect">
    <area target="" alt="" title="" href="models.html#intermediate-stop-frequency" coords="5,481,663,505" shape="rect">
    <area target="" alt="" title="" href="models.html#atwork-subtour-scheduling" coords="516,401,666,427" shape="rect">
    <area target="" alt="" title="" href="models.html#atwork-subtour-destination" coords="517,361,667,385" shape="rect">
    <area target="" alt="" title="" href="models.html#atwork-subtour-frequency" coords="515,243,667,265" shape="rect">
    <area target="" alt="" title="" href="models.html#non-mandatory-tour-scheduling" coords="347,404,497,425" shape="rect">
    <area target="" alt="" title="" href="models.html#non-mandatory-tour-destination-choice" coords="347,363,496,384" shape="rect">
    <area target="" alt="" title="" href="models.html#non-mandatory-tour-frequency" coords="347,245,495,267" shape="rect">
    <area target="" alt="" title="" href="models.html#joint-tour-scheduling" coords="175,402,327,424" shape="rect">
    <area target="" alt="" title="" href="models.html#joint-tour-destination-choice" coords="175,361,326,386" shape="rect">
    <area target="" alt="" title="" href="models.html#joint-tour-participation" coords="175,324,326,345" shape="rect">
    <area target="" alt="" title="" href="models.html#joint-tour-composition" coords="176,282,326,307" shape="rect">
    <area target="" alt="" title="" href="models.html#joint-tour-frequency" coords="176,243,327,266" shape="rect">
    <area target="" alt="" title="" href="models.html#tour-mode" coords="5,442,667,464" shape="rect">
    <area target="" alt="" title="" href="models.html#mandatory-tour-scheduling" coords="5,401,156,425" shape="rect">
    <area target="" alt="" title="" href="models.html#mandatory-tour-frequency" coords="5,241,157,267" shape="rect">
    <area target="" alt="" title="" href="models.html#cdap" coords="235,165,434,189" shape="rect">
    <area target="" alt="" title="" href="models.html#free-parking-eligibility" coords="239,126,435,148" shape="rect">
    <area target="" alt="" title="" href="models.html#auto-ownership" coords="237,86,433,109" shape="rect">
    <area target="" alt="" title="" href="models.html#school-location" coords="237,43,435,67" shape="rect">
    <area target="" alt="" title="" href="models.html#accessibility" coords="236,6,436,27" shape="rect">
   </map>
    <p>The output of the model is a disggregate table of trips with individual attributes for custom analysis.  The trips
can be aggregated into travel demand matrices for network loading.</p>
</div>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>The following describes the example model setup.</p>
<div class="section" id="folder-and-file-setup">
<h3>Folder and File Setup<a class="headerlink" href="#folder-and-file-setup" title="Permalink to this headline">¶</a></h3>
<p>The example has the following root folder/file setup:</p>
<blockquote>
<div><ul class="simple">
<li><p>configs - settings, expressions files, etc.</p></li>
<li><p>configs_mp - override settings for the multiprocess configuration</p></li>
<li><p>data - input data such as land use, synthetic population files, and skims</p></li>
<li><p>output - outputs folder</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h3>
<p>In order to run the example, you first need the input files in the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder as identified in the <code class="docutils literal notranslate"><span class="pre">configs\settings.yaml</span></code> file:</p>
<ul>
<li><p>input_table_list: the input CSV tables from MTC travel model one:</p>
<blockquote>
<div><ul class="simple">
<li><p>households - Synthetic population household records for a subset of zones.</p></li>
<li><p>persons - Synthetic population person records for a subset of zones.</p></li>
<li><p>land_use - Zone-based land use data (population and employment for example) for a subset of zones.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>skims_file: skims.omx - an OMX matrix file containing the MTC travel model one skim matrices for a subset of zones.</p></li>
</ul>
<p>These files are used in the tests as well and are in the <code class="docutils literal notranslate"><span class="pre">activitysim\abm\test\data</span></code> folder.  The full set
of MTC TM1 households, persons, and OMX skims are on the MTC <a class="reference external" href="https://mtcdrive.app.box.com/v/activitysim">box account</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ActivitySim can optionally build an HDF5 file of the input CSV tables for use in subsequent runs since
HDF5 is binary and therefore results in faster read times. see <a class="reference internal" href="#configuration"><span class="std std-ref">Configuration</span></a></p>
<p>OMX and HDF5 files can be viewed with the <a class="reference external" href="https://github.com/osPlanning/omx/wiki/OMX-Viewer">OMX Viewer</a> or
<a class="reference external" href="https://www.hdfgroup.org/downloads/hdfview">HDFView</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">other_resources\scripts\build_omx.py</span></code> script will build one OMX file containing all the skims. The original MTC TM1 skims were converted from
Cube to OMX using the <code class="docutils literal notranslate"><span class="pre">other_resources\scripts\mtc_tm1_omx_export.s</span></code> script.</p>
<p>The example inputs were created by the <code class="docutils literal notranslate"><span class="pre">other_resources\scripts\create_sf_example.py</span></code> script, which creates the land use, synthetic population, and
skim inputs for a subset of user-defined zones.</p>
</div>
</div>
<div class="section" id="configuration">
<span id="id2"></span><h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder contains settings, expressions files, and other files required for specifying
model utilities and form.  The first place to start in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder is <code class="docutils literal notranslate"><span class="pre">settings.yaml</span></code>, which
is the main settings file for the model run.  This file includes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">models</span></code> - list of model steps to run - auto ownership, tour frequency, etc. - see <a class="reference internal" href="#model-steps"><span class="std std-ref">Pipeline</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume_after</span></code> - to resume running the data pipeline after the last successful checkpoint</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_store</span></code> - HDF5 inputs file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_table_list</span></code> - list of table names, indices, and column re-maps for each table in <cite>input_store</cite></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tablename</span></code> - name of the injected table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> - name of the CSV or HDF5 file to read (optional, defaults to <cite>input_store</cite>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index_col</span></code> - table column to use for the index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rename_columns</span></code> - dictionary of column name mappings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_columns</span></code> - columns to keep once read in to memory to save on memory needs and file I/O</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h5_tablename</span></code> - table name if reading from HDF5 and different from <cite>tablename</cite></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">create_input_store</span></code> - write new ‘input_data.h5’ file to outputs folder using CSVs from <cite>input_table_list</cite> to use for subsequent model runs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skims_file</span></code> - skim matrices in one OMX file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">households_sample_size</span></code> - number of households to sample and simulate; comment out to simulate all households</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trace_hh_id</span></code> - trace household id; comment out for no trace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trace_od</span></code> - trace origin, destination pair in accessibility calculation; comment out for no trace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> - batch size for processing choosers, see <a class="reference internal" href="#chunk-size"><span class="std std-ref">Chunk size</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_for_variability</span></code> - disable check for variability in an expression result debugging feature in order to speed-up runtime</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_shadow_pricing</span></code> - turn shadow_pricing on and off for work and school location</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_tables</span></code> - list of output tables to write to CSV or HDF5</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">want_dest_choice_sample_tables</span></code> - turn writing of sample_tables on and off for all models</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_skim_cache</span></code> - read cached skims (using numpy memmap) from output directory (memmap is faster than omx)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write_skim_cache</span></code> - write memmapped cached skims to output directory after reading from omx, for use in subsequent runs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skim_cache_dir</span></code> - alternate dir to read/write skim cache (defaults to output_dir)</p></li>
<li><p>global variables that can be used in expressions tables and Python code such as:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">urban_threshold</span></code> - urban threshold area type max value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">county_map</span></code> - mapping of county codes to county names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skim_time_periods</span></code> - time period upper bound values and labels</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time_window</span></code> - total duration (in minutes) of the modeled time span (Default: 1440 minutes (24 hours))</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">period_minutes</span></code> - length of time (in minutes) each model time period represents. Must be whole factor of <code class="docutils literal notranslate"><span class="pre">time_window</span></code>. (Default: 60 minutes)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">periods</span></code> - Breakpoints that define the aggregate periods for skims and assignment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels</span></code> - Labels to define names for aggregate periods for skims and assignment</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">household_median_value_of_time</span></code> - various household and person value-of-time model settings</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="sub-model-specification-files">
<span id="sub-model-spec-files"></span><h3>Sub-Model Specification Files<a class="headerlink" href="#sub-model-specification-files" title="Permalink to this headline">¶</a></h3>
<p>Included in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder are the model specification files that store the
Python/pandas/numpy expressions, alternatives, and other settings used by each model.  Some models includes an
alternatives file since the alternatives are not easily described as columns in the expressions file.  An example
of this is the <code class="docutils literal notranslate"><span class="pre">non_mandatory_tour_frequency_alternatives.csv</span></code> file, which lists each alternative as a row and each
columns indicates the number of non-mandatory tours by purpose.  The current set of files are below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Specification Files</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#initialize-landuse"><span class="std std-ref">Initialize</span></a></p></td>
<td><ul class="simple">
<li><p>initialize_landuse.yaml</p></li>
<li><p>annotate_landuse.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#accessibility"><span class="std std-ref">Accessibility</span></a></p></td>
<td><ul class="simple">
<li><p>accessibility.yaml</p></li>
<li><p>accessibility.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#initialize-households"><span class="std std-ref">Initialize</span></a></p></td>
<td><ul class="simple">
<li><p>initialize_households.yaml</p></li>
<li><p>annotate_persons.csv</p></li>
<li><p>annotate_households.csv</p></li>
<li><p>annotate_persons_after_hh.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#school-location"><span class="std std-ref">School Location</span></a></p></td>
<td><ul class="simple">
<li><p>school_location.yaml</p></li>
<li><p>school_location_coeffs.csv</p></li>
<li><p>annotate_persons_school.csv</p></li>
<li><p>school_location_sample.csv</p></li>
<li><p>tour_mode_choice.yaml (and related files)</p></li>
<li><p>school_location.csv</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
<li><p>shadow_pricing.yaml</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#work-location"><span class="std std-ref">School Location</span></a></p></td>
<td><ul class="simple">
<li><p>workplace_location.yaml</p></li>
<li><p>workplace_location_coeffs.csv</p></li>
<li><p>annotate_persons_workplace.csv</p></li>
<li><p>annotate_households_workplace.csv</p></li>
<li><p>workplace_location_sample.csv</p></li>
<li><p>tour_mode_choice.yaml (and related files)</p></li>
<li><p>workplace_location.csv</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
<li><p>shadow_pricing.yaml</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#auto-ownership"><span class="std std-ref">Auto Ownership</span></a></p></td>
<td><ul class="simple">
<li><p>auto_ownership.yaml</p></li>
<li><p>auto_ownership_coeffs.csv</p></li>
<li><p>auto_ownership.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#freeparking"><span class="std std-ref">Free Parking Eligibility</span></a></p></td>
<td><ul class="simple">
<li><p>free_parking.yaml</p></li>
<li><p>free_parking_coeffs.csv</p></li>
<li><p>free_parking.csv</p></li>
<li><p>free_parking_annotate_persons_preprocessor.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#cdap"><span class="std std-ref">Coordinated Daily Activity Pattern</span></a></p></td>
<td><ul class="simple">
<li><p>cdap.yaml</p></li>
<li><p>annotate_persons_cdap.csv</p></li>
<li><p>annotate_households_cdap.csv</p></li>
<li><p>cdap_indiv_and_hhsize1.csv</p></li>
<li><p>cdap_interaction_coefficients.csv</p></li>
<li><p>cdap_fixed_relative_proportions.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#mandatory-tour-frequency"><span class="std std-ref">Mandatory Tour Frequency</span></a></p></td>
<td><ul class="simple">
<li><p>mandatory_tour_frequency.yaml</p></li>
<li><p>mandatory_tour_frequency_coeffs.csv</p></li>
<li><p>mandatory_tour_frequency.csv</p></li>
<li><p>mandatory_tour_frequency_alternatives.csv</p></li>
<li><p>annotate_persons_mtf.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#mandatory-tour-scheduling"><span class="std std-ref">Mandatory Tour Scheduling</span></a></p></td>
<td><ul class="simple">
<li><p>mandatory_tour_scheduling.yaml</p></li>
<li><p>tour_scheduling_work_coeffs.csv</p></li>
<li><p>tour_scheduling_work.csv</p></li>
<li><p>tour_scheduling_school.csv</p></li>
<li><p>tour_departure_and_duration_alternatives.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#joint-tour-frequency"><span class="std std-ref">Joint Tour Frequency</span></a></p></td>
<td><ul class="simple">
<li><p>joint_tour_frequency.yaml</p></li>
<li><p>joint_tour_frequency_coeffs.csv</p></li>
<li><p>annotate_persons_jtf.csv</p></li>
<li><p>joint_tour_frequency_annotate_households_preprocessor.csv</p></li>
<li><p>joint_tour_frequency_alternatives.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#joint-tour-composition"><span class="std std-ref">Joint Tour Composition</span></a></p></td>
<td><ul class="simple">
<li><p>joint_tour_composition.yaml</p></li>
<li><p>joint_tour_composition_coeffs.csv</p></li>
<li><p>joint_tour_composition_annotate_households_preprocessor.csv</p></li>
<li><p>joint_tour_composition.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#joint-tour-participation"><span class="std std-ref">Joint Tour Participation</span></a></p></td>
<td><ul class="simple">
<li><p>joint_tour_participation.yaml</p></li>
<li><p>joint_tour_participation_coeffs.csv</p></li>
<li><p>joint_tour_participation_annotate_participants_preprocessor.csv</p></li>
<li><p>joint_tour_participation.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#joint-tour-destination-choice"><span class="std std-ref">Joint Tour Destination Choice</span></a></p></td>
<td><ul class="simple">
<li><p>joint_tour_destination.yaml</p></li>
<li><p>non_mandatory_tour_destination_coeffs.csv</p></li>
<li><p>non_mandatory_tour_destination_sample.csv</p></li>
<li><p>non_mandatory_tour_destination.csv</p></li>
<li><p>tour_mode_choice.yaml (and related files)</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#joint-tour-scheduling"><span class="std std-ref">Joint Tour Scheduling</span></a></p></td>
<td><ul class="simple">
<li><p>joint_tour_scheduling.yaml</p></li>
<li><p>tour_scheduling_joint_coeffs.csv</p></li>
<li><p>joint_tour_scheduling_annotate_tours_preprocessor.csv</p></li>
<li><p>tour_scheduling_joint.csv</p></li>
<li><p>tour_departure_and_duration_alternatives.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#non-mandatory-tour-frequency"><span class="std std-ref">Non-Mandatory Tour Frequency</span></a></p></td>
<td><ul class="simple">
<li><p>non_mandatory_tour_frequency.yaml</p></li>
<li><p>non_mandatory_tour_frequency_coeffs_{ptype}.csv</p></li>
<li><p>non_mandatory_tour_frequency.csv</p></li>
<li><p>non_mandatory_tour_frequency_alternatives.csv</p></li>
<li><p>non_mandatory_tour_frequency_annotate_persons_preprocessor.csv</p></li>
<li><p>non_mandatory_tour_frequency_extension_probs.csv</p></li>
<li><p>annotate_persons_nmtf.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#non-mandatory-tour-destination-choice"><span class="std std-ref">Non-Mandatory Tour Destination Choice</span></a></p></td>
<td><ul class="simple">
<li><p>non_mandatory_tour_destination.yaml</p></li>
<li><p>non_mandatory_tour_destination_coeffs.csv</p></li>
<li><p>non_mandatory_tour_destination.csv</p></li>
<li><p>non_mandatory_tour_destination_sample.csv</p></li>
<li><p>tour_mode_choice.yaml (and related files)</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#non-mandatory-tour-scheduling"><span class="std std-ref">Non-Mandatory Tour Scheduling</span></a></p></td>
<td><ul class="simple">
<li><p>non_mandatory_tour_scheduling.yaml</p></li>
<li><p>tour_scheduling_nonmandatory_coeffs.csv</p></li>
<li><p>non_mandatory_tour_scheduling_annotate_tours_preprocessor.csv</p></li>
<li><p>tour_scheduling_nonmandatory.csv</p></li>
<li><p>tour_departure_and_duration_alternatives.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#tour-mode-choice"><span class="std std-ref">Tour Mode Choice</span></a></p></td>
<td><ul class="simple">
<li><p>tour_mode_choice.yaml</p></li>
<li><p>tour_mode_choice_annotate_choosers_preprocessor.csv</p></li>
<li><p>tour_mode_choice.csv</p></li>
<li><p>tour_mode_choice_coeffs.csv</p></li>
<li><p>tour_mode_choice_coeffs_template.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#atwork-subtour-frequency"><span class="std std-ref">At-work Subtours Frequency</span></a></p></td>
<td><ul class="simple">
<li><p>atwork_subtour_frequency.yaml</p></li>
<li><p>atwork_subtour_frequency_coeffs.csv</p></li>
<li><p>atwork_subtour_frequency.csv</p></li>
<li><p>atwork_subtour_frequency_alternatives.csv</p></li>
<li><p>atwork_subtour_frequency_annotate_tours_preprocessor.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#atwork-subtour-destination"><span class="std std-ref">At-work Subtours Destination Choice</span></a></p></td>
<td><ul class="simple">
<li><p>atwork_subtour_destination.yaml</p></li>
<li><p>atwork_subtour_destination_coeffs.csv</p></li>
<li><p>atwork_subtour_destination_sample.csv</p></li>
<li><p>atwork_subtour_destination.csv</p></li>
<li><p>tour_mode_choice.yaml (and related files)</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#atwork-subtour-scheduling"><span class="std std-ref">At-work Subtour Scheduling</span></a></p></td>
<td><ul class="simple">
<li><p>tour_scheduling_atwork.yaml</p></li>
<li><p>tour_scheduling_atwork_coeffs.csv</p></li>
<li><p>tour_scheduling_atwork.csv</p></li>
<li><p>tour_scheduling_atwork_preprocessor.csv</p></li>
<li><p>tour_departure_and_duration_alternatives.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#atwork-subtour-mode-choice"><span class="std std-ref">At-work Subtour Mode</span></a></p></td>
<td><ul class="simple">
<li><p>tour_mode_choice.yaml (and related files)</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#intermediate-stop-frequency"><span class="std std-ref">Intermediate Stop Frequency</span></a></p></td>
<td><ul class="simple">
<li><p>stop_frequency.yaml</p></li>
<li><p>stop_frequency_annotate_tours_preprocessor.csv</p></li>
<li><p>stop_frequency_alternatives.csv</p></li>
<li><p>stop_frequency_atwork.csv</p></li>
<li><p>stop_frequency_eatout.csv</p></li>
<li><p>stop_frequency_escort.csv</p></li>
<li><p>stop_frequency_othdiscr.csv</p></li>
<li><p>stop_frequency_othmaint.csv</p></li>
<li><p>stop_frequency_school.csv</p></li>
<li><p>stop_frequency_shopping.csv</p></li>
<li><p>stop_frequency_social.csv</p></li>
<li><p>stop_frequency_subtour.csv</p></li>
<li><p>stop_frequency_univ.csv</p></li>
<li><p>stop_frequency_work.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#trip-purpose"><span class="std std-ref">Trip Purpose</span></a></p></td>
<td><ul class="simple">
<li><p>trip_purpose.yaml (+ trip_purpose_and_destination.yaml)</p></li>
<li><p>trip_purpose_annotate_trips_preprocessor.csv</p></li>
<li><p>trip_purpose_probs.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#trip-destination-choice"><span class="std std-ref">Trip Destination Choice</span></a></p></td>
<td><ul class="simple">
<li><p>trip_destination.yaml (+ trip_purpose_and_destination.yaml)</p></li>
<li><p>trip_destination.csv</p></li>
<li><p>trip_destination_annotate_trips_preprocessor.csv</p></li>
<li><p>trip_destination_sample.csv</p></li>
<li><p>trip_mode_choice.yaml (and related files)</p></li>
<li><p>destination_choice_size_terms.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#trip-scheduling"><span class="std std-ref">Trip Scheduling</span></a></p></td>
<td><ul class="simple">
<li><p>trip_scheduling.yaml</p></li>
<li><p>trip_scheduling_probs.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="models.html#trip-mode-choice"><span class="std std-ref">Trip Mode Choice</span></a></p></td>
<td><ul class="simple">
<li><p>trip_mode_choice.yaml</p></li>
<li><p>trip_mode_choice_annotate_trips_preprocessor.csv</p></li>
<li><p>trip_mode_choice_coeffs.csv</p></li>
<li><p>trip_mode_choice.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="models.html#write-trip-matrices"><span class="std std-ref">Write Trip Matrices</span></a></p></td>
<td><ul class="simple">
<li><p>write_trip_matrices.yaml</p></li>
<li><p>write_trip_matrices_annotate_trips_preprocessor.csv</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="chunk-size">
<span id="index-2"></span><span id="id3"></span><h3>Chunk size<a class="headerlink" href="#chunk-size" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> is the number of doubles in a chunk of the choosers table.  It is approximately the number
of rows times the number of columns and it needs to be set to a value that efficiently processes the table with
the available RAM.  For example, a chunk size of 1,000,000 could be 100,000 household records with 10 columns of attributes.
Setting the chunk size too high will run into memory errors such as <code class="docutils literal notranslate"><span class="pre">OverflowError:</span> <span class="pre">Python</span> <span class="pre">int</span>
<span class="pre">too</span> <span class="pre">large</span> <span class="pre">to</span> <span class="pre">convert</span> <span class="pre">to</span> <span class="pre">C</span> <span class="pre">long.</span></code> Setting the chunk size too low may result in smaller than optimal vector
lengths, which may waste runtime.  The chunk size is dependent on the size of the population, the complexity
of the utility expressions, the amount of RAM on the machine, and other problem specific dimensions.  Thus,
it needs to be set via experimentation.</p>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>Included in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder is the <code class="docutils literal notranslate"><span class="pre">logging.yaml</span></code>, which configures Python logging
library and defines two key log files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">activitysim.log</span></code> - overall system log file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hhtrace.log</span></code> - household trace log file if tracing is on</p></li>
</ul>
<p>Refer to the <a class="reference internal" href="#tracing"><span class="std std-ref">Tracing</span></a> section for more detail on tracing.</p>
</div>
<div class="section" id="pipeline">
<span id="model-steps"></span><h3>Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">models</span></code> setting contains the specification of the data pipeline model steps, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="p">:</span>
   <span class="o">-</span> <span class="n">initialize_landuse</span>
   <span class="o">-</span> <span class="n">compute_accessibility</span>
   <span class="o">-</span> <span class="n">initialize_households</span>
   <span class="o">-</span> <span class="n">school_location</span>
   <span class="o">-</span> <span class="n">workplace_location</span>
   <span class="o">-</span> <span class="n">auto_ownership_simulate</span>
   <span class="o">-</span> <span class="n">free_parking</span>
   <span class="o">-</span> <span class="n">cdap_simulate</span>
   <span class="o">-</span> <span class="n">mandatory_tour_frequency</span>
   <span class="o">-</span> <span class="n">mandatory_tour_scheduling</span>
   <span class="o">-</span> <span class="n">joint_tour_frequency</span>
   <span class="o">-</span> <span class="n">joint_tour_composition</span>
   <span class="o">-</span> <span class="n">joint_tour_participation</span>
   <span class="o">-</span> <span class="n">joint_tour_destination</span>
   <span class="o">-</span> <span class="n">joint_tour_scheduling</span>
   <span class="o">-</span> <span class="n">non_mandatory_tour_frequency</span>
   <span class="o">-</span> <span class="n">non_mandatory_tour_destination</span>
   <span class="o">-</span> <span class="n">non_mandatory_tour_scheduling</span>
   <span class="o">-</span> <span class="n">tour_mode_choice_simulate</span>
   <span class="o">-</span> <span class="n">atwork_subtour_frequency</span>
   <span class="o">-</span> <span class="n">atwork_subtour_destination</span>
   <span class="o">-</span> <span class="n">atwork_subtour_scheduling</span>
   <span class="o">-</span> <span class="n">atwork_subtour_mode_choice</span>
   <span class="o">-</span> <span class="n">stop_frequency</span>
   <span class="o">-</span> <span class="n">trip_purpose</span>
   <span class="o">-</span> <span class="n">trip_destination</span>
   <span class="o">-</span> <span class="n">trip_purpose_and_destination</span>
   <span class="o">-</span> <span class="n">trip_scheduling</span>
   <span class="o">-</span> <span class="n">trip_mode_choice</span>
   <span class="o">-</span> <span class="n">write_data_dictionary</span>
   <span class="o">-</span> <span class="n">track_skim_usage</span>
   <span class="o">-</span> <span class="n">write_trip_matrices</span>
   <span class="o">-</span> <span class="n">write_tables</span>
</pre></div>
</div>
<p>These model steps must be registered orca steps, as noted below.  If you provide a <code class="docutils literal notranslate"><span class="pre">resume_after</span></code>
argument to <a class="reference internal" href="core.html#activitysim.core.pipeline.run" title="activitysim.core.pipeline.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">activitysim.core.pipeline.run()</span></code></a> the pipeliner will load checkpointed tables from the checkpoint store
and resume pipeline processing on the next model step after the specified checkpoint.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resume_after</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1">#resume_after = &#39;school_location&#39;</span>
</pre></div>
</div>
<p>The model is run by calling the <a class="reference internal" href="core.html#activitysim.core.pipeline.run" title="activitysim.core.pipeline.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">activitysim.core.pipeline.run()</span></code></a> method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">_MODELS</span><span class="p">,</span> <span class="n">resume_after</span><span class="o">=</span><span class="n">resume_after</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users can skip persisting tables to the pipeline data store on disk by adding an underscore prefix to the models in the
models list in the settings file: _school_location instead of school_location.  This will cut down on the disk writes.</p>
</div>
</div>
</div>
<div class="section" id="running-the-mtc-example">
<span id="example-run"></span><h2>Running the MTC Example<a class="headerlink" href="#running-the-mtc-example" title="Permalink to this headline">¶</a></h2>
<p>To run the example, do the following:</p>
<ul class="simple">
<li><p>Activate the correct conda environment if needed</p></li>
<li><p>View the list of available examples</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">create</span> <span class="o">--</span><span class="nb">list</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Create a local copy of an example folder</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">create</span> <span class="o">--</span><span class="n">example</span> <span class="n">example_mtc</span> <span class="o">--</span><span class="n">destination</span> <span class="n">my_test_example</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Run the example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">run</span> <span class="o">--</span><span class="n">working_dir</span> <span class="n">my_test_example</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">run</span> <span class="o">-</span><span class="n">c</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">configs</span> <span class="o">-</span><span class="n">d</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">o</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">output</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ActivitySim should log some information and write outputs to the output folder.</p></li>
</ul>
<p>The example should complete within a couple minutes since it is running a small sample of households.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A customizable run script for power users can be found in the <a class="reference external" href="https://github.com/ActivitySim/activitysim/tree/master/scripts">Github repo</a>.
This script takes many of the same arguments as the <code class="docutils literal notranslate"><span class="pre">activitysim</span> <span class="pre">run</span></code> command, including paths to
<code class="docutils literal notranslate"><span class="pre">--config</span></code>, <code class="docutils literal notranslate"><span class="pre">--data</span></code>, and <code class="docutils literal notranslate"><span class="pre">--output</span></code> directories. It looks for these folders in the current
working directory by default.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simulation</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="multiprocessing">
<h3>Multiprocessing<a class="headerlink" href="#multiprocessing" title="Permalink to this headline">¶</a></h3>
<p>The model system is parallelized via <a class="reference internal" href="howitworks.html#multiprocessing"><span class="std std-ref">Multiprocessing</span></a>.  To setup and run the <a class="reference internal" href="#example"><span class="std std-ref">Example</span></a> using
multiprocessing, follow the same steps as the above <a class="reference internal" href="#example-run"><span class="std std-ref">Running the MTC Example</span></a>, but add an additional <code class="docutils literal notranslate"><span class="pre">-c</span></code> flag to
include the multiprocessing configuration settings as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">run</span> <span class="o">-</span><span class="n">c</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">configs_mp</span> <span class="o">-</span><span class="n">c</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">configs</span> <span class="o">-</span><span class="n">d</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">data</span> <span class="o">-</span><span class="n">o</span> <span class="n">my_test_example</span><span class="o">/</span><span class="n">output</span>
</pre></div>
</div>
<p>The multiprocessing example also writes outputs to the output folder.</p>
<p>The default multiprocessed example is configured to run with two processors: <code class="docutils literal notranslate"><span class="pre">num_processes:</span> <span class="pre">2</span></code>.  Additional more performant configurations are
included and commented out in the example settings file.  For example, the 100 percent sample multiprocessing example was run on a Windows Server
machine with 28 cores &#64; 2.56GHz and 224GB RAM with the configuration below.  See <a class="reference internal" href="howitworks.html#multiprocessing"><span class="std std-ref">Multiprocessing</span></a> for more information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">households_sample_size</span><span class="p">:</span>  <span class="mi">0</span>
<span class="n">chunk_size</span><span class="p">:</span>  <span class="mi">5000000000</span>
<span class="n">num_processes</span><span class="p">:</span> <span class="mi">24</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Anaconda Python on Windows uses the <a class="reference external" href="https://software.intel.com/en-us/mkl">Intel Math Kernel Library</a> for
many of its computationally intensive low-level C/C++ calculations.  By default, MKL threads many of its routines
in order to be performant out-of-the-box.  However, for ActivitySim multiprocessing, which processes households in
parallel since they are largely independent of one another, it can be advantageous to override threading within
processes and instead let ActivitySim run each process with one computing core or thread.  In order to do so,
override the MKL number of threads setting via a system environment variable that is set before running the model.
In practice, this means before running the model, first set the MKL number of threads variable via the command
line as follows: SET MKL_NUM_THREADS=1</p>
</div>
</div>
</div>
<div class="section" id="outputs">
<h2>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<p>The key output of ActivitySim is the HDF5 data pipeline file <code class="docutils literal notranslate"><span class="pre">outputs\pipeline.h5</span></code>.  This file contains a copy
of each key data table after each model step in which the table was modified.  The example also writes the final tables to
CSV files by using the <a class="reference internal" href="core.html#activitysim.core.pipeline.get_table" title="activitysim.core.pipeline.get_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">activitysim.core.pipeline.get_table()</span></code></a> method via the <code class="docutils literal notranslate"><span class="pre">write_tables</span></code> step.
This method returns a pandas DataFrame, which is then written to a CSV file by the <code class="docutils literal notranslate"><span class="pre">write_tables</span></code> step.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">other_resources\scripts\make_pipeline_output.py</span></code> script uses the information stored in the pipeline file to create
the table below for a small sample of households.  The table shows that for each table in the pipeline, the number of rows
and/or columns changes as a result of the relevant model step.  A <code class="docutils literal notranslate"><span class="pre">checkpoints</span></code> table is also stored in the
pipeline, which contains the crosswalk between model steps and table states in order to reload tables for
restarting the pipeline at any step.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 43%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Table</p></th>
<th class="head"><p>Creator</p></th>
<th class="head"><p>NRow</p></th>
<th class="head"><p>NCol</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>accessibility</p></td>
<td><p>compute_accessibility</p></td>
<td><p>1454</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>households</p></td>
<td><p>initialize</p></td>
<td><p>100</p></td>
<td><p>65</p></td>
</tr>
<tr class="row-even"><td><p>households</p></td>
<td><p>workplace_location</p></td>
<td><p>100</p></td>
<td><p>66</p></td>
</tr>
<tr class="row-odd"><td><p>households</p></td>
<td><p>cdap_simulate</p></td>
<td><p>100</p></td>
<td><p>73</p></td>
</tr>
<tr class="row-even"><td><p>households</p></td>
<td><p>joint_tour_frequency</p></td>
<td><p>100</p></td>
<td><p>75</p></td>
</tr>
<tr class="row-odd"><td><p>joint_tour_participants</p></td>
<td><p>joint_tour_participation</p></td>
<td><p>13</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>land_use</p></td>
<td><p>initialize_landuse</p></td>
<td><p>1454</p></td>
<td><p>44</p></td>
</tr>
<tr class="row-odd"><td><p>person_windows</p></td>
<td><p>initialize_households</p></td>
<td><p>271</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-even"><td><p>persons</p></td>
<td><p>initialize_households</p></td>
<td><p>271</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-odd"><td><p>persons</p></td>
<td><p>school_location</p></td>
<td><p>271</p></td>
<td><p>45</p></td>
</tr>
<tr class="row-even"><td><p>persons</p></td>
<td><p>workplace_location</p></td>
<td><p>271</p></td>
<td><p>52</p></td>
</tr>
<tr class="row-odd"><td><p>persons</p></td>
<td><p>free_parking</p></td>
<td><p>271</p></td>
<td><p>53</p></td>
</tr>
<tr class="row-even"><td><p>persons</p></td>
<td><p>cdap_simulate</p></td>
<td><p>271</p></td>
<td><p>59</p></td>
</tr>
<tr class="row-odd"><td><p>persons</p></td>
<td><p>mandatory_tour_frequency</p></td>
<td><p>271</p></td>
<td><p>64</p></td>
</tr>
<tr class="row-even"><td><p>persons</p></td>
<td><p>joint_tour_participation</p></td>
<td><p>271</p></td>
<td><p>65</p></td>
</tr>
<tr class="row-odd"><td><p>persons</p></td>
<td><p>non_mandatory_tour_frequency</p></td>
<td><p>271</p></td>
<td><p>74</p></td>
</tr>
<tr class="row-even"><td><p>school_destination_size</p></td>
<td><p>initialize_households</p></td>
<td><p>1454</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>school_modeled_size</p></td>
<td><p>school_location</p></td>
<td><p>1454</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>tours</p></td>
<td><p>mandatory_tour_frequency</p></td>
<td><p>153</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>tours</p></td>
<td><p>mandatory_tour_scheduling</p></td>
<td><p>153</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-even"><td><p>tours</p></td>
<td><p>joint_tour_composition</p></td>
<td><p>159</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>tours</p></td>
<td><p>tour_mode_choice_simulate</p></td>
<td><p>319</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-even"><td><p>tours</p></td>
<td><p>atwork_subtour_frequency</p></td>
<td><p>344</p></td>
<td><p>19</p></td>
</tr>
<tr class="row-odd"><td><p>tours</p></td>
<td><p>stop_frequency</p></td>
<td><p>344</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-even"><td><p>trips</p></td>
<td><p>stop_frequency</p></td>
<td><p>859</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>trips</p></td>
<td><p>trip_purpose</p></td>
<td><p>859</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>trips</p></td>
<td><p>trip_destination</p></td>
<td><p>859</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>trips</p></td>
<td><p>trip_scheduling</p></td>
<td><p>859</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>trips</p></td>
<td><p>trip_mode_choice</p></td>
<td><p>859</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>workplace_destination_size</p></td>
<td><p>initialize_households</p></td>
<td><p>1454</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>workplace_modeled_size</p></td>
<td><p>workplace_location</p></td>
<td><p>1454</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">write_trip_matrices</span></code> step processes the trips table to create open matrix (OMX) trip matrices for
assignment.  The matrices are configured and coded according to the expressions in the model step
trip annotation file.  See <a class="reference internal" href="models.html#write-trip-matrices"><span class="std std-ref">Write Trip Matrices</span></a> for more information.</p>
<p>ActivitySim also writes log and trace files to the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> folder.  The activitysim.log file,
which is the overall log file is always produced.  If tracing is specified, then trace files are
output as well.</p>
<div class="section" id="tracing">
<span id="id4"></span><h3>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h3>
<p>There are two types of tracing in ActivtiySim: household and origin-destination (OD) pair.  If a household trace ID
is specified, then ActivitySim will output a comprehensive set (i.e. hundreds) of trace files for all
calculations for all household members:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hhtrace.log</span></code> - household trace log file, which specifies the CSV files traced. The order of output files is consistent with the model sequence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">various</span> <span class="pre">CSV</span> <span class="pre">files</span></code> - every input, intermediate, and output data table - chooser, expressions/utilities, probabilities, choices, etc. - for the trace household for every sub-model</p></li>
</ul>
<p>If an OD pair trace is specified, then ActivitySim will output the acessibility calculations trace
file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">accessibility.result.csv</span></code> - accessibility expression results for the OD pair</p></li>
</ul>
<p>With the set of output CSV files, the user can trace ActivitySim calculations in order to ensure they are correct and/or to
help debug data and/or logic errors.</p>
</div>
<div class="section" id="writing-logsums">
<span id="id5"></span><h3>Writing Logsums<a class="headerlink" href="#writing-logsums" title="Permalink to this headline">¶</a></h3>
<p>The tour and trip destination and mode choice models calculate logsums but do not persist them by default.
Mode and destination choice logsums are essential for re-estimating these models and can therefore be
saved to the pipeline if desired.  To save the tour and trip destination and mode choice model logsums, include
the following optional settings in the model settings file.  The data is saved to the pipeline for later use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in workplace_location.yaml for example</span>
<span class="n">DEST_CHOICE_LOGSUM_COLUMN_NAME</span><span class="p">:</span> <span class="n">workplace_location_logsum</span>
<span class="n">DEST_CHOICE_SAMPLE_TABLE_NAME</span><span class="p">:</span> <span class="n">workplace_location_sample</span>

<span class="c1"># in tour_mode_choice.yaml for example</span>
<span class="n">MODE_CHOICE_LOGSUM_COLUMN_NAME</span><span class="p">:</span> <span class="n">mode_choice_logsum</span>
</pre></div>
</div>
<p>The <cite>DEST_CHOICE_SAMPLE_TABLE_NAME</cite> contains the fields in the table below.  Writing out the
destination choice sample table, which includes the mode choice logsum for each sampled
alternative destination, adds significant size to the pipeline.  Therefore, this feature should
only be activated when writing logsums for a small set of households for model estimation.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>chooser_id</p></td>
<td><p>chooser id such as person or tour id</p></td>
</tr>
<tr class="row-odd"><td><p>alt_dest</p></td>
<td><p>destination alternative id</p></td>
</tr>
<tr class="row-even"><td><p>prob</p></td>
<td><p>alternative probability</p></td>
</tr>
<tr class="row-odd"><td><p>pick_count</p></td>
<td><p>sampling with replacement pick count</p></td>
</tr>
<tr class="row-even"><td><p>mode_choice_logsum</p></td>
<td><p>mode choice logsum</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="estimation">
<span id="id6"></span><h2>Estimation<a class="headerlink" href="#estimation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Estimation mode is under development.  Estimation mode has not yet been implemented for the
trip models (stop_frequency, trip_destination, trip_scheduling, and trip_mode_choice).  The trip
model expressions files are also in the old format - i.e. data and coefficients have yet to be
separated into different files.</p>
</div>
<p>ActivitySim includes the ability to easily re-estimate submodels using choice model estimation tools
such as <a class="reference external" href="https://larch.newman.me/">larch</a>.  In order to do so, ActivitySim adopts the concept of an estimation
data bundle (EDB), which is a collection of the necessary data to restimate a submodel.  For example, for the auto ownership submodel,
the EDB consists of the following files:</p>
<ul class="simple">
<li><p>model settings - the auto_ownership_model_settings.yaml file</p></li>
<li><p>coefficients - the auto_ownership_coefficients.csv file with each coefficient name, value, and constrain set to True or False if the coefficient is estimatable</p></li>
<li><p>utilities specification - the auto_ownership_SPEC.csv utility expressions file</p></li>
<li><p>chooser and alternatives data - the auto_ownership_values_combined.csv file with all chooser and alternatives data such as household information, land use information, and the utility data components for each alternative</p></li>
</ul>
<p>ActivitySim also includes <a class="reference internal" href="#estimation-example"><span class="std std-ref">Example</span></a> Jupyter notebooks for estimating models with larch.</p>
<p>The combination of writing an EDB for a submodel + a larch estimation notebook means users can easily re-estimate submodels. This
combination of functionality means:</p>
<ul class="simple">
<li><p>There is no duplication of model specifications. ActivitySim owns the specification and larch pivots off of it.  Users code model specifications and utility expressions in ActivitySim so as to facilitate ease of use and eliminate inconsistencies and errors between the code used to estimate the models and the code used to apply the models.</p></li>
<li><p>The EDB includes all the data and model structure information and the larch.util.activitysim module used by the example notebooks processes the EDB to setup and estimate the models.</p></li>
<li><p>Users are able to add zones, alternatives, new chooser data, new taz data, new modes, new coefficients, revise utilities, and revise nesting structures in ActivitySim and larch responds accordingly.</p></li>
<li><p>Eventually it may be desirable for ActivitySim to automatically write larch estimators (or other types of estimators), but for now the integration is loosely coupled rather than tightly coupled in order to provide flexibility.</p></li>
</ul>
<div class="section" id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<p>The general workflow for estimating models is shown in the figure below and explained in more detail below.</p>
<img alt="_images/estimation_example.jpg" src="_images/estimation_example.jpg" />
<ul class="simple">
<li><p>The user converts their household travel survey into ActivitySim format households, persons, tours, joint tour participants, and trip tables.  The households and persons tables must have the same fields as the synthetic population input tables since the surveyed households and persons will be run through the same set of submodels as the simulated households and persons.</p></li>
<li><p>The ActivitySim estimation example <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> module reads the ActivitySim format household travel survey files and checks for inconsistencies in the input tables versus the model design + calculates additional fields such as the household joint tour frequency based on the trips and joint tour participants table.  Survey households and persons observed choices much match the model design (i.e. a person cannot have more work tours than the model allows).</p></li>
<li><p>ActivitySim is then run in estimation mode to read the ActivitySim format household travel survey files, run the ActivitySim submodels to write estimation data bundles (EDB) that contains the model utility specifications, coefficients, chooser data, and alternatives data for each submodel.  Estimation mode runs single-processed and without destination sampling.</p></li>
<li><p>The relevant EDBs are read and transformed into the format required by the model estimation tool (i.e. larch) and then the coefficients are re-estimated.</p></li>
<li><p>The user can then update the ActivitySim model coefficients file for the estimated submodel and re-run the model in simulation mode.  The user may want to use the restartable pipeline feature of ActivitySim to just run the submodel of interest.</p></li>
</ul>
</div>
<div class="section" id="estimation-example">
<span id="id7"></span><h3>Example<a class="headerlink" href="#estimation-example" title="Permalink to this headline">¶</a></h3>
<p>To run the estimation example, do the following:</p>
<ul class="simple">
<li><p>Activate the correct conda environment if needed</p></li>
<li><p>Create a local copy of the estimation example folder</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">create</span> <span class="o">-</span><span class="n">e</span> <span class="n">example_estimation</span> <span class="o">-</span><span class="n">d</span> <span class="n">test_example_estimation</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Run the example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">test_example_estimation</span>
<span class="n">activitysim</span> <span class="n">run</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs_estimation</span><span class="o">/</span><span class="n">configs</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs</span> <span class="o">-</span><span class="n">o</span> <span class="n">output</span> <span class="o">-</span><span class="n">d</span> <span class="n">data_test</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ActivitySim should log some information and write outputs to the output folder, including EDBs for each submodel.  The estimation example runs in about 5 minutes and writes EDBs for 2000 households.</p></li>
<li><p>Open the relevant estimation with larch example Jupyter Notebook and re-estimate the submodel:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/develop/activitysim/examples/example_estimation/notebooks/estimating_auto_ownership.ipynb/">Estimating auto ownership</a></p></li>
<li><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/develop/activitysim/examples/example_estimation/notebooks/estimating_school_location.ipynb/">Estimating school location</a></p></li>
<li><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/develop/activitysim/examples/example_estimation/notebooks/estimating_workplace_location.ipynb/">Estimating work location</a></p></li>
<li><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/develop/activitysim/examples/example_estimation/notebooks/estimating_tour_mode_choice.ipynb/">Estimating tour mode choice</a></p></li>
</ul>
</li>
<li><p>Save the updated coefficient file to the configs folder and run the model in simulation mode.</p></li>
</ul>
</div>
<div class="section" id="settings">
<h3>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h3>
<p>Additional settings for running ActivitySim in estimation mode are specified in an <code class="docutils literal notranslate"><span class="pre">estimation.yaml</span></code> file that is specified in addition to <code class="docutils literal notranslate"><span class="pre">settings.yaml</span></code>.  The settings are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code> - enable estimation, either True or False</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bundles</span></code> - the list of submodels for which to write EDBs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">survey_tables</span></code> - the list of input ActivitySim format survey tables with observed choices to override model simulation choices in order to write EDBs.  These tables are the output of the <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> script that pre-processes the ActivitySim format household travel survey files</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="models.html" class="btn btn-neutral float-right" title="Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gettingstarted.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright contributing authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>