
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Estimation &#8212; ActivitySim 1.2.1.dev7+g08c7ab2f</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/design-tabs.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How the System Works" href="howitworks.html" />
    <link rel="prev" title="Command Line Interface" href="cli.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">ActivitySim</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="users-guide/index.html">
  Users Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="dev-guide/index.html">
  Developers
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        1.2.1  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables estimation and {'json_url': 'https://activitysim.github.io/activitysim/switcher.json', 'version_match': '1.2.1'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "estimation.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://activitysim.github.io/activitysim/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "estimation.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 1.2.1 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "1.2.1") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="gettingstarted.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="users-guide/cli-tools.html">
   Command Line Tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="users-guide/configuration.html">
   Configuration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.Settings.html">
     Settings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.InputTable.html">
     InputTable
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.OutputTable.html">
     OutputTable
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.OutputTables.html">
     OutputTables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.MultiprocessStep.html">
     MultiprocessStep
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.MultiprocessStepSlice.html">
     MultiprocessStepSlice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.NetworkSettings.html">
     NetworkSettings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.TAZ_Settings.html">
     TAZ_Settings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="users-guide/_generated/activitysim.core.configuration.DigitalEncoding.html">
     DigitalEncoding
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   Command Line Interface
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="howitworks.html">
   How the System Works
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#workflow">
   Workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#settings">
   Settings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimation-notebooks">
   Estimation Notebooks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-activitysim.estimation.larch.general">
   General API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-activitysim.estimation.larch.auto_ownership">
   Models API
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="estimation">
<span id="id1"></span><h1>Estimation<a class="headerlink" href="#estimation" title="Permalink to this headline">#</a></h1>
<p>ActivitySim includes the ability to re-estimate submodels using choice model estimation tools
such as <a class="reference external" href="https://larch.newman.me/">larch</a>.  To do so, ActivitySim adopts the concept of an estimation
data bundle (EDB), which is a collection of the necessary data to re-estimate a submodel.  For example, for the auto ownership submodel,
the EDB consists of the following files:</p>
<ul class="simple">
<li><p>model settings - the auto_ownership_model_settings.yaml file</p></li>
<li><p>coefficients - the auto_ownership_coefficients.csv file with each coefficient name, value, and constrain set to True or False if the coefficient is estimatable</p></li>
<li><p>utilities specification - the auto_ownership_SPEC.csv utility expressions file</p></li>
<li><p>chooser and alternatives data - the auto_ownership_values_combined.csv file with all chooser and alternatives data such as household information, land use information, and the utility data components for each alternative</p></li>
</ul>
<p>ActivitySim also includes Jupyter <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> for estimating submodels with larch, as well as an <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> submodule that transforms EDBs into larch models.  Additional estimation software translators can be added later if desired.</p>
<p>The combination of writing an EDB for a submodel + a larch estimation notebook means users can easily re-estimate submodels. This
combination of functionality means:</p>
<ul class="simple">
<li><p>There is no duplication of model specifications. ActivitySim owns the specification and larch pivots off of it.  Users code model specifications and utility expressions in ActivitySim so as to facilitate ease of use and eliminate inconsistencies and errors between the code used to estimate the models and the code used to apply the models.</p></li>
<li><p>The EDB includes all the data and model structure information and the <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> submodule used by the example notebooks transforms the EDB to larch’s data model for estimation.</p></li>
<li><p>Users are able to add zones, alternatives, new chooser data, new taz data, new modes, new coefficients, revise utilities, and revise nesting structures in ActivitySim and larch responds accordingly.</p></li>
<li><p>Eventually it may be desirable for ActivitySim to automatically write larch estimators (or other types of estimators), but for now the integration is loosely coupled rather than tightly coupled in order to provide flexibility.</p></li>
</ul>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">#</a></h2>
<p>The general workflow for estimating models is shown in the following figures and explained in more detail below.</p>
<img alt="_images/estimation_tools.jpg" src="_images/estimation_tools.jpg" />
<ul class="simple">
<li><p>The user converts their household travel survey into ActivitySim format households, persons, tours, joint tour participants, and trip tables.  The households and persons tables must have the same fields as the synthetic population input tables since the surveyed households and persons will be run through the same set of submodels as the simulated households and persons.</p></li>
<li><p>The ActivitySim estimation example <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> module reads the ActivitySim format household travel survey files and checks for inconsistencies in the input tables versus the model design + calculates additional fields such as the household joint tour frequency based on the trips and joint tour participants table.  Survey households and persons observed choices much match the model design (i.e. a person cannot have more work tours than the model allows).</p></li>
<li><p>ActivitySim is then run in estimation mode to read the ActivitySim format household travel survey files, run the ActivitySim submodels to write estimation data bundles (EDB) that contains the model utility specifications, coefficients, chooser data, and alternatives data for each submodel.  Estimation mode runs single-processed and without destination sampling.</p></li>
<li><p>The relevant EDBs are read and transformed into the format required by the model estimation tool (i.e. larch) and then the coefficients are re-estimated. The <code class="docutils literal notranslate"><span class="pre">activitysim.estimation.larch</span></code> library is included for integration with larch and there is a Jupyter Notebook estimation example for each core submodel.  No changes to the model specification are made in the process.</p></li>
<li><p>The user can then update the ActivitySim model coefficients file(s) for the estimated submodel and re-run the model in simulation mode.  The user may want to use the restartable pipeline feature of ActivitySim to just run the submodel of interest.</p></li>
</ul>
<img alt="_images/estimation_example.jpg" src="_images/estimation_example.jpg" />
</section>
<section id="example">
<span id="estimation-example"></span><h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The estimation_mode.ipynb Jupyter <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> also introduces estimation mode and walks the user through the process.</p>
</div>
<p>To run the estimation example, do the following:</p>
<ul class="simple">
<li><p>Activate the correct conda environment if needed</p></li>
<li><p>Create a local copy of the estimation example folder</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activitysim</span> <span class="n">create</span> <span class="o">-</span><span class="n">e</span> <span class="n">example_estimation_sf</span> <span class="o">-</span><span class="n">d</span> <span class="n">test_example_estimation_sf</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Run the example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">test_example_estimation_sf</span>
<span class="n">activitysim</span> <span class="n">run</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs_estimation</span><span class="o">/</span><span class="n">configs</span> <span class="o">-</span><span class="n">c</span> <span class="n">configs</span> <span class="o">-</span><span class="n">o</span> <span class="n">output</span> <span class="o">-</span><span class="n">d</span> <span class="n">data_sf</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ActivitySim should log some information and write outputs to the output folder, including EDBs for each submodel.  The estimation example runs for about 15 minutes and writes EDBs for 2000 households.</p></li>
<li><p>Open <a class="reference internal" href="#estimation-example-notebooks"><span class="std std-ref">Estimation Notebooks</span></a> for a specific submodel and then step through the notebook to re-estimate the sub-model.</p></li>
</ul>
<p>The estimation example assumes the machine has sufficient RAM to run with chunking disabled (<cite>chunk_training_mode: disabled</cite>).  See <a class="reference internal" href="core.html#chunk-size"><span class="std std-ref">Chunk</span></a> for more information.</p>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">#</a></h2>
<p>Additional settings for running ActivitySim in estimation mode are specified in the <code class="docutils literal notranslate"><span class="pre">estimation.yaml</span></code> file.  The settings are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code> - enable estimation, either True or False</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bundles</span></code> - the list of submodels for which to write EDBs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">survey_tables</span></code> - the list of input ActivitySim format survey tables with observed choices to override model simulation choices in order to write EDBs.  These tables are the output of the <code class="docutils literal notranslate"><span class="pre">scripts\infer.py</span></code> script that pre-processes the ActivitySim format household travel survey files for the example data and submodels</p></li>
</ul>
</section>
<section id="estimation-notebooks">
<span id="estimation-example-notebooks"></span><h2>Estimation Notebooks<a class="headerlink" href="#estimation-notebooks" title="Permalink to this headline">#</a></h2>
<p>ActivitySim includes a <a class="reference external" href="https://jupyter.org">Jupyter Notebook</a> recipe book with interactive re-estimation examples for each estimatable submodel.  To run a Jupyter notebook, do the following:</p>
<ul class="simple">
<li><p>Open a conda prompt and activate the conda environment with ActivitySim installed</p></li>
<li><p>If needed, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">jupyterlab</span></code> so you can run jupyter notebooks</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> to launch the web-based notebook manager</p></li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">examples/examples_estimaton/notebooks</span></code> folder and select a notebook from the table below</p></li>
<li><p>Save the updated coefficient file(s) to the configs folder and run the model in simulation mode</p></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>Notebook</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Estimation mode overview</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/01_estimation_mode.ipynb">01_estimation_mode.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>School location</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/02_school_location.ipynb">02_school_location.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Work location</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/03_work_location.ipynb">03_work_location.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Auto ownership</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/04_auto_ownership.ipynb">04_auto_ownership.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Free parking</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/05_free_parking.ipynb">05_free_parking.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>CDAP</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/06_cdap.ipynb">06_cdap.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Mandatory tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/07_mand_tour_freq.ipynb">07_mand_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Work tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/08_work_tour_scheduling.ipynb">08_work_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>School tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/09_school_tour_scheduling.ipynb">09_school_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Joint tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/10_joint_tour_freq.ipynb">10_joint_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Jointatory tour composition</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/11_joint_tour_composition.ipynb">11_joint_tour_composition.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Jointatory tour participation</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/12_joint_tour_participation.ipynb">12_joint_tour_participation.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Joint nonmandatory tour destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/13_joint_nonmand_tour_dest.ipynb">13_joint_nonmand_tour_dest.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Joint tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/14_joint_tour_scheduling.ipynb">14_joint_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Non mandatory tour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/15_non_mand_tour_freq.ipynb">15_non_mand_tour_freq.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Non mandatory tour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/16_nonmand_tour_scheduling.ipynb">16_nonmand_tour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Tour mode choice</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/17_tour_mode_choice.ipynb">17_tour_mode_choice.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Atwork subtour frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/18_atwork_subtour_freq.ipynb">18_atwork_subtour_freq.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Atwork subtour destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/19_atwork_subtour_dest.ipynb">19_atwork_subtour_dest.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Atwork subtour scheduling</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/20_atwork_subtour_scheduling.ipynb">20_atwork_subtour_scheduling.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Stop frequency</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/21_stop_frequency.ipynb">21_stop_frequency.ipynb</a></p></td>
</tr>
<tr class="row-odd"><td><p>Trip destination</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/22_trip_dest.ipynb">22_trip_dest.ipynb</a></p></td>
</tr>
<tr class="row-even"><td><p>Trip mode choice</p></td>
<td><p><a class="reference external" href="https://github.com/activitysim/activitysim/blob/main/activitysim/examples/example_estimation/notebooks/23_trip_mode_choice.ipynb">23_trip_mode_choice.ipynb</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-activitysim.estimation.larch.general">
<span id="general-api"></span><h2>General API<a class="headerlink" href="#module-activitysim.estimation.larch.general" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.apply_coef_template">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">apply_coef_template</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linear_utility</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.apply_coef_template" title="Permalink to this definition">#</a></dt>
<dd><p>Apply a coefficient template over a linear utility function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>linear_utility</strong><span class="classifier">LinearFunction_C</span></dt><dd></dd>
<dt><strong>template_col</strong><span class="classifier">Mapping</span></dt><dd></dd>
<dt><strong>condition</strong><span class="classifier">any</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>LinearFunction_C</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.apply_coefficients">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">apply_coefficients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coefficients</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minimum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maximum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.apply_coefficients" title="Permalink to this definition">#</a></dt>
<dd><p>Read the coefficients CSV file to a DataFrame and set model parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coefficients</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>The coefficients table in the ActivitySim data bundle
for this model.</p>
</dd>
<dt><strong>model</strong><span class="classifier">Model</span></dt><dd><p>Apply coefficient values and constraints to this model.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.clean_values">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">clean_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">choice_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'override_choice'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alt_names_to_codes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">choice_code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'override_choice_code'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.clean_values" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>values</strong><span class="classifier">pd.DataFrame</span></dt><dd></dd>
<dt><strong>alt_names</strong><span class="classifier">Collection</span></dt><dd></dd>
<dt><strong>override_choice</strong><span class="classifier">str</span></dt><dd><p>The columns of <cite>values</cite> containing the observed choices.</p>
</dd>
<dt><strong>alt_names_to_codes</strong><span class="classifier">Mapping, optional</span></dt><dd><p>If the <cite>override_choice</cite> column contains alternative names,
use this mapping to convert the names into alternative code
numbers.</p>
</dd>
<dt><strong>choice_code</strong><span class="classifier">str, default ‘override_choice_code’</span></dt><dd><p>The name of the observed choice code number column that will
be added to <cite>values</cite>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>pd.DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.construct_nesting_tree">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">construct_nesting_tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alternatives</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nesting_settings</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.construct_nesting_tree" title="Permalink to this definition">#</a></dt>
<dd><p>Construct a NestingTree from ActivitySim settings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>alternatives</strong><span class="classifier">Mapping or Sequence</span></dt><dd><p>If given as a Mapping (dict), the keys are the alternative names
as strings, and the values are alternative code numbers to use
in larch.  If given as a Sequence, the values are the alternative
names, and unique sequential codes will be created starting from 1.</p>
</dd>
<dt><strong>nesting_settings</strong><span class="classifier">Mapping</span></dt><dd><p>The ‘NESTS’ section of the ActivitySim config file.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>NestingTree</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.cv_to_ca">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">cv_to_ca</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alt_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float64'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.cv_to_ca" title="Permalink to this definition">#</a></dt>
<dd><p>Convert a choosers-variables DataFrame to an idca DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>alt_values</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>This DataFrame should be in choosers-variables format,
with one row per chooser and variable, and one column per
alternative.  The id’s for the choosers and variables
must be in that order, in a two-level MultiIndex.</p>
</dd>
<dt><strong>dtype</strong><span class="classifier">dtype</span></dt><dd><p>Convert the incoming data to this type.  Set to None to
skip data conversion.</p>
</dd>
<dt><strong>required_labels</strong><span class="classifier">Collection, optional</span></dt><dd><p>If given, any columns in the output that are not required
will be pre-emptively dropped.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>pandas.DataFrame</dt><dd><p>The resulting DataFrame is transformed into Larch’s
idca format, with one row per chooser (case) and
alternative, and one column per variable.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.dict_of_linear_utility_from_spec">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">dict_of_linear_utility_from_spec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.dict_of_linear_utility_from_spec" title="Permalink to this definition">#</a></dt>
<dd><p>Create a linear function from a spec DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>spec</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>A spec for an ActivitySim model.</p>
</dd>
<dt><strong>x_col: str</strong></dt><dd><p>The name of the columns in spec representing the data.</p>
</dd>
<dt><strong>p_col: dict</strong></dt><dd><p>The name of the columns in spec representing the parameters.
The keys give the names of the columns to use, and the
values will become the keys of the output dictionary.</p>
</dd>
<dt><strong>ignore_x</strong><span class="classifier">Collection, optional</span></dt><dd><p>Labels in the spec file to ignore.  Typically this
includes variables that are pre-processed by ActivitySim
and therefore don’t need to be made available in Larch.</p>
</dd>
<dt><strong>segment_id</strong><span class="classifier">str, optional</span></dt><dd><p>The CHOOSER_SEGMENT_COLUMN_NAME identified for ActivitySim.
This value is ignored if <cite>p_col</cite> is a string, and required
if <cite>p_col</cite> is a dict.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dict</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.explicit_value_parameters">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">explicit_value_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.explicit_value_parameters" title="Permalink to this definition">#</a></dt>
<dd><p>Define and lock parameters given as fixed values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">larch.Model</span></dt><dd><p>The model to insert fixed value parameters.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"></dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.explicit_value_parameters_from_spec">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">explicit_value_parameters_from_spec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.explicit_value_parameters_from_spec" title="Permalink to this definition">#</a></dt>
<dd><p>Define and lock parameters given as fixed values in the spec.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>spec</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>A spec for an ActivitySim model.</p>
</dd>
<dt><strong>p_col</strong><span class="classifier">str or dict</span></dt><dd><p>The name of the columns in spec representing the parameters.
Give as a string for a single column, or as a dict to
have segments on multiple columns. If given as a dict,
the keys give the names of the columns to use, and the
values give the identifiers that will need to match the
loaded <cite>segment_id</cite> value.  Only the keys are used in this
function.</p>
</dd>
<dt><strong>model</strong><span class="classifier">larch.Model</span></dt><dd><p>The model to insert fixed value parameters.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"></dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.linear_utility_from_spec">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">linear_utility_from_spec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.linear_utility_from_spec" title="Permalink to this definition">#</a></dt>
<dd><p>Create a linear function from a spec DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>spec</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>A spec for an ActivitySim model.</p>
</dd>
<dt><strong>x_col: str</strong></dt><dd><p>The name of the columns in spec representing the data.</p>
</dd>
<dt><strong>p_col: str or dict</strong></dt><dd><p>The name of the columns in spec representing the parameters.
Give as a string for a single column, or as a dict to
have segments on multiple columns. If given as a dict,
the keys give the names of the columns to use, and the
values give the identifiers that will need to match the
loaded <cite>segment_id</cite> value.</p>
</dd>
<dt><strong>ignore_x</strong><span class="classifier">Collection, optional</span></dt><dd><p>Labels in the spec file to ignore.  Typically this
includes variables that are pre-processed by ActivitySim
and therefore don’t need to be made available in Larch.</p>
</dd>
<dt><strong>segment_id</strong><span class="classifier">str, optional</span></dt><dd><p>The CHOOSER_SEGMENT_COLUMN_NAME identified for ActivitySim.
This value is ignored if <cite>p_col</cite> is a string, and required
if <cite>p_col</cite> is a dict.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>LinearFunction_C</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.prevent_overlapping_column_names">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">prevent_overlapping_column_names</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ca</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_co</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.prevent_overlapping_column_names" title="Permalink to this definition">#</a></dt>
<dd><p>Rename columns in idca data to prevent overlapping names.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>x_ca, x_co</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>The idca and idco data, respectively</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>x_ca, x_co</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.general.remove_apostrophes">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.general.</span></span><span class="sig-name descname"><span class="pre">remove_apostrophes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_columns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.general.remove_apostrophes" title="Permalink to this definition">#</a></dt>
<dd><p>Remove apostrophes from columns names and from data in given columns.</p>
<p>Also strips leading and trailing whitespace.</p>
<p>This function operates in-place on DataFrames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>df</strong><span class="classifier">pandas.DataFrame</span></dt><dd></dd>
<dt><strong>from_columns</strong><span class="classifier">Collection, optional</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>pandas.DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-activitysim.estimation.larch.data_maker"></span><span class="target" id="module-activitysim.estimation.larch.simple_simulate"></span><dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.simple_simulate.construct_availability">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.simple_simulate.</span></span><span class="sig-name descname"><span class="pre">construct_availability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chooser_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alt_codes_to_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.simple_simulate.construct_availability" title="Permalink to this definition">#</a></dt>
<dd><p>Construct an availability dataframe based on -999 parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">larch.Model</span></dt><dd></dd>
<dt><strong>chooser_data</strong><span class="classifier">pandas.DataFrame</span></dt><dd></dd>
<dt><strong>alt_codes_to_names</strong><span class="classifier">Mapping[int,str]</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>pandas.DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-activitysim.estimation.larch.auto_ownership">
<span id="models-api"></span><h2>Models API<a class="headerlink" href="#module-activitysim.estimation.larch.auto_ownership" title="Permalink to this headline">#</a></h2>
<span class="target" id="module-activitysim.estimation.larch.cdap"></span><dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.cdap.apply_replacements">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.cdap.</span></span><span class="sig-name descname"><span class="pre">apply_replacements</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expression</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tokens</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.cdap.apply_replacements" title="Permalink to this definition">#</a></dt>
<dd><p>Convert general person terms to specific person terms for the CDAP model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>expression</strong><span class="classifier">str</span></dt><dd><p>An expression from the “Expression” column
of cdap_INDIV_AND_HHSIZE1_SPEC.csv, or similar.</p>
</dd>
<dt><strong>prefix</strong><span class="classifier">str</span></dt><dd><p>A prefix to attach to each token in <cite>expression</cite>.</p>
</dd>
<dt><strong>tokens</strong><span class="classifier">list-like of str</span></dt><dd><p>A list of tokens to edit within an expression.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>expression</strong><span class="classifier">str</span></dt><dd><p>The modified expression</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.cdap.cdap_base_utility_by_person">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.cdap.</span></span><span class="sig-name descname"><span class="pre">cdap_base_utility_by_person</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_persons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_tokens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.cdap.cdap_base_utility_by_person" title="Permalink to this definition">#</a></dt>
<dd><p>Build the base utility by person for each pattern.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">larch.Model</span></dt><dd></dd>
<dt><strong>n_persons</strong><span class="classifier">int</span></dt><dd></dd>
<dt><strong>spec</strong><span class="classifier">pandas.DataFrame</span></dt><dd><p>The base utility by person spec provided by
the ActivitySim framework.</p>
</dd>
<dt><strong>alts</strong><span class="classifier">dict, optional</span></dt><dd><p>The keys are the names of the patterns, and
the values are the alternative code numbers,
as created by <cite>generate_alternatives</cite>.  If not
given, the alts are automatically regenerated
using that function.</p>
</dd>
<dt><strong>value_tokens</strong><span class="classifier">list-like of str, optional</span></dt><dd><p>A list of tokens to edit within an the expressions,
generally the column names of the provided values
from the estimation data bundle.  Only used when
<cite>n_persons</cite> is more than 1.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.cdap.generate_alternatives">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.cdap.</span></span><span class="sig-name descname"><span class="pre">generate_alternatives</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_persons</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.cdap.generate_alternatives" title="Permalink to this definition">#</a></dt>
<dd><p>Generate a dictionary of CDAP alternatives.</p>
<p>The keys are the names of the patterns, and
the values are the alternative code numbers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>n_persons</strong><span class="classifier">int</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>Dict</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.cdap.interact_pattern">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.cdap.</span></span><span class="sig-name descname"><span class="pre">interact_pattern</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_persons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_persons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.cdap.interact_pattern" title="Permalink to this definition">#</a></dt>
<dd><p>Compile a regex pattern to match CDAP alternatives.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>n_persons</strong><span class="classifier">int</span></dt><dd></dd>
<dt><strong>select_persons</strong><span class="classifier">list-like of int</span></dt><dd><p>The persons to be selected.</p>
</dd>
<dt><strong>tag</strong><span class="classifier">str</span></dt><dd><p>The activity letter, currently one of {M,N,H}.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>re.compile</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-activitysim.estimation.larch.location_choice"></span><span class="target" id="module-activitysim.estimation.larch.mode_choice"></span><span class="target" id="module-activitysim.estimation.larch.nonmand_tour_freq"></span><dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.nonmand_tour_freq.nonmand_tour_freq_model">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.nonmand_tour_freq.</span></span><span class="sig-name descname"><span class="pre">nonmand_tour_freq_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">edb_directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'output/estimation_data_bundle/{name}/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condense_parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.nonmand_tour_freq.nonmand_tour_freq_model" title="Permalink to this definition">#</a></dt>
<dd><p>Prepare nonmandatory tour frequency models for estimation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>edb_directory</strong><span class="classifier">str</span></dt><dd><p>Location of estimation data bundle for these models.</p>
</dd>
<dt><strong>return_data</strong><span class="classifier">bool, default False</span></dt><dd><p>Whether to return the data used in preparing this function.
If returned, data is a dict in the second return value.</p>
</dd>
<dt><strong>condense_parameters</strong><span class="classifier">bool, default False</span></dt><dd><p>Apply a transformation whereby all parameters in each model that
have the same initial value are converted to have the same name
(and thus to be the same parameter, used in various places).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-activitysim.estimation.larch.scheduling"></span><dl class="py function">
<dt class="sig sig-object py" id="activitysim.estimation.larch.scheduling.construct_availability_ca">
<span class="sig-prename descclassname"><span class="pre">activitysim.estimation.larch.scheduling.</span></span><span class="sig-name descname"><span class="pre">construct_availability_ca</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chooser_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alt_codes_to_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.estimation.larch.scheduling.construct_availability_ca" title="Permalink to this definition">#</a></dt>
<dd><p>Construct an availability dataframe based on -999 parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">larch.Model</span></dt><dd></dd>
<dt><strong>chooser_data</strong><span class="classifier">pandas.DataFrame</span></dt><dd></dd>
<dt><strong>alt_codes_to_names</strong><span class="classifier">Mapping[int,str]</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>pandas.DataFrame</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-activitysim.estimation.larch.stop_frequency"></span></section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="cli.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Command Line Interface</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="howitworks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How the System Works</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <!-- This will display the version of the docs -->
<p class="last-updated">
ActivitySim 1.2.1.dev7+g08c7ab2f, documentation last updated Feb 06, 2023.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>