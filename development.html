

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Development &mdash; ActivitySim 0.5.2
 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="ActivitySim 0.5.2
 documentation" href="index.html"/>
        <link rel="prev" title="Models" href="models.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ActivitySim
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="abmexample.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="howitworks.html">How the System Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataschema.html">Data Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#software-design">Software Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#style">Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-together-in-the-repository">Working Together in the Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiling">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#releases">Releases</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ActivitySim</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Development</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>This page documents how to contribute to ActivitySim.</p>
<p>In developing this software platform, we strive to adhere to a best practices approach to scientific computing,
as summarized in <a class="reference external" href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001745">this article.</a></p>
<div class="section" id="software-design">
<h2>Software Design<a class="headerlink" href="#software-design" title="Permalink to this headline">¶</a></h2>
<p>ActivitySim is implemented in Python, and makes heavy use of the vectorized backend
C/C++ libraries in pandas and numpy. The core design principle of the system is
vectorization of for loops, and this principle is woven into the system wherever
reasonable. As a result, the Python portions of the software can be thought of as
more of an orchestrator, data processor, etc. that integrates a series of C/C++
vectorized data table and matrix operations. The model system formulates each
simulation as a series of vectorized table operations and the Python layer is
responsible for setting up and providing expressions to operate on these large
data tables.</p>
</div>
<div class="section" id="style">
<h2>Style<a class="headerlink" href="#style" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Python code should follow the <a class="reference external" href="https://pypi.python.org/pypi/pycodestyle">pycodestyle style guide</a></li>
<li>Python docstrings should follow the <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">numpydoc documentation format</a></li>
</ul>
</div>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Imports should be one per line.</li>
<li>Imports should be grouped into standard library, third-party, and intra-library imports.</li>
<li><code class="docutils literal notranslate"><span class="pre">from</span></code> import should follow regular <code class="docutils literal notranslate"><span class="pre">imports</span></code>.</li>
<li>Within each group the imports should be alphabetized.</li>
<li>Imports of scientific Python libraries should follow these conventions:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
</pre></div>
</div>
</div>
<div class="section" id="working-together-in-the-repository">
<h2>Working Together in the Repository<a class="headerlink" href="#working-together-in-the-repository" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="https://guides.github.com/introduction/flow">GitHub Flow</a>.  The key points to
our GitHub workflow are:</p>
<ul class="simple">
<li>The master branch contains the latest working/release version of the ActivitySim resources</li>
<li>The master branch is protected and therefore can only be written to by the <a class="reference external" href="https://travis-ci.org/">Travis</a> CI system</li>
<li>Work is done in an issue/feature branch (or a fork) and then pushed to a new brach in the repo</li>
<li>The test system automatically runs the tests on the new branch</li>
<li>If the tests pass, then a manual pull request can be approved to merge into master</li>
<li>The repository administrator handles the pull request and makes sure that related resources such as the wiki, documentation, issues, etc. are updated</li>
<li>Every time a merge is made to master, the version should be incremented and a new package posted to PyPI</li>
</ul>
</div>
<div class="section" id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h2>
<p>ActivitySim uses the following <a class="reference external" href="http://the-hitchhikers-guide-to-packaging.readthedocs.io/en/latest/specification.html">versioning convention</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MAJOR</span><span class="o">.</span><span class="n">MINOR</span><span class="p">[</span><span class="o">.</span><span class="n">MICRO</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>where MAJOR designates a major revision number for the software, like 2 or 3 for Python. Usually, raising a major revision number means that you are adding a lot of features, breaking backward-compatibility or drastically changing the APIs or ABIs.</li>
<li>MINOR usually groups moderate changes to the software like bug fixes or minor improvements. Most of the time, end users can upgrade with no risks their software to a new minor release. In case an API changes, the end users will be notified with deprecation warnings. In other words, API and ABI stability is usually a promise between two minor releases.</li>
<li>Some softwares use a third level: MICRO. This level is used when the release cycle of minor release is quite long. In that case, micro releases are dedicated to bug fixes.</li>
</ul>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>ActivitySim testing is done with three tools:</p>
<ul class="simple">
<li><a class="reference external" href="https://pypi.python.org/pypi/pycodestyle">pycodestyle</a>, a tool to check Python code against the pycodestyle style conventions</li>
<li><a class="reference external" href="http://pytest.org/latest/">pytest</a>, a Python testing tool</li>
<li><a class="reference external" href="https://github.com/coagulant/coveralls-python">coveralls</a>, a tool for measuring code coverage and publishing code coverage stats online</li>
</ul>
<p>To run the tests locally, first make sure the required packages are installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">cov</span> <span class="n">coveralls</span> <span class="n">pycodestyle</span>
</pre></div>
</div>
<p>Next, run the tests with the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pycodestyle</span> <span class="n">activitysim</span>
<span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="o">--</span><span class="n">cov</span> <span class="n">activitysim</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">term</span><span class="o">-</span><span class="n">missing</span>
</pre></div>
</div>
<p>These same tests are run by Travis with each push to the repository.  These tests need to pass in order
to merge the revisions into master.</p>
<p>In some cases, test targets need to be updated to match the new results produced by the code since these
are now the correct results.  In order to update the test targets, first determine which tests are
failing and then review the failing lines in the source files.  These are easy to identify since each
test ultimately comes down to one of Python’s various types of <cite>assert</cite> statements.  Once you identify
which <cite>assert</cite> is failing, you can work your way back through the code that creates the test targets in
order to update it.  After updating the test targets, re-run the tests to confirm the new code passes all
the tests.</p>
</div>
<div class="section" id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h2>
<p>A good way to profile ActivitySim model runs is to use <a class="reference external" href="https://jiffyclub.github.io/snakeviz/">snakeviz</a>.
To do so, first install snakeviz and then run ActivitySim with the Python profiler (cProfile) to create
a profiler file.  Then run snakeviz on the profiler file to interactively explore the component runtimes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">snakeviz</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">cProfile</span> <span class="o">-</span><span class="n">o</span> <span class="n">asim</span><span class="o">.</span><span class="n">prof</span> <span class="n">simulation</span><span class="o">.</span><span class="n">py</span>
<span class="n">snakeviz</span> <span class="n">asim</span><span class="o">.</span><span class="n">prof</span>
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>The documentation is written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> markup
and built with <a class="reference external" href="http://www.sphinx-doc.org/en/stable/">Sphinx</a>.  In addition to converting rst files
to html and other document formats, these tools also read the inline Python docstrings and convert
them into html as well.  ActivitySim’s docstrings are written in <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">numpydoc format</a> since it is easier to use
than standard rst format.</p>
<p>To build the documentation, first make sure the required packages are installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">sphinx</span> <span class="n">numpydoc</span> <span class="n">sphinx_rtd_theme</span>
</pre></div>
</div>
<p>Next, build the documentation in html format with the following command run from the <code class="docutils literal notranslate"><span class="pre">docs</span></code> folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
<p>If the activitysim package is installed, then the documentation will be built from that version of
the source code instead of the git repo version.  Make sure to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">activitysim</span></code> before
bulding the documentation if needed.</p>
<p>When pushing revisions to the repo, the documentation is automatically built by Travis after
successfully passing the tests.  The documents are built with the <code class="docutils literal notranslate"><span class="pre">bin/build_docs.sh</span></code> script.
The script does the following:</p>
<ul class="simple">
<li>installs the required python packages</li>
<li>runs <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code></li>
<li>copies the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch <code class="docutils literal notranslate"><span class="pre">../activitysim/docs/_build/html/*</span></code> pages to the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch</li>
</ul>
<p>GitHub automagically publishes the gh-pages branch at <a class="reference external" href="https://udst.github.io/activitysim">https://udst.github.io/activitysim</a>.</p>
</div>
<div class="section" id="releases">
<h2>Releases<a class="headerlink" href="#releases" title="Permalink to this headline">¶</a></h2>
<p>ActivitySim releases are manually uploaded to the <a class="reference external" href="https://pypi.python.org/pypi/activitysim">Python Package Index</a>  (pypi).</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="models.html" class="btn btn-neutral" title="Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright contributing authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>