

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Models &mdash; ActivitySim 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="ActivitySim 0.1 documentation" href="index.html"/>
        <link rel="next" title="Development" href="development.html"/>
        <link rel="prev" title="Core Utilities" href="core.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ActivitySim
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataschema.html">Data Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core Utilities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accessibility">Accessibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-activitysim.defaults.models.accessibility">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#auto-ownership">Auto Ownership</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#coordinated-daily-activity-pattern-cdap">Coordinated Daily Activity Pattern (CDAP)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">cdap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-activitysim.defaults.models.cdap">models.cdap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#destination-choice">Destination Choice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mandatory-scheduling">Mandatory Scheduling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mandatory-tour-frequency">Mandatory Tour Frequency</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mode-tour-and-trip">Mode (Tour and Trip)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tour">Tour</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trip">Trip</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-mandatory-scheduling">Non-Mandatory Scheduling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-mandatory-tour-frequency">Non-Mandatory Tour Frequency</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#school-location">School Location</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#workplace-location">Workplace Location</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ActivitySim</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Models</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="models">
<h1>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h1>
<p>The currently implemented example ActivitySim models are described below.</p>
<div class="section" id="accessibility">
<h2>Accessibility<a class="headerlink" href="#accessibility" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the accessibility model is the
<code class="xref py py-func docutils literal"><span class="pre">compute_accessibility()</span></code>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;compute_accessibility&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">skims</span></code> | Result Table: <code class="docutils literal"><span class="pre">accessibility</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">O-D,</span> <span class="pre">D-O</span></code></p>
<div class="section" id="module-activitysim.defaults.models.accessibility">
<span id="api"></span><h3>API<a class="headerlink" href="#module-activitysim.defaults.models.accessibility" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="activitysim.defaults.models.accessibility.AccessibilitySkims">
<em class="property">class </em><code class="descclassname">activitysim.defaults.models.accessibility.</code><code class="descname">AccessibilitySkims</code><span class="sig-paren">(</span><em>skims</em>, <em>omx</em>, <em>length</em>, <em>transpose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.accessibility.AccessibilitySkims" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for skim arrays to facilitate use of skims by accessibility model</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>skims</strong> : 2D array</p>
<p><strong>omx: open omx file object</strong></p>
<blockquote>
<div><p>this is only used to load skims on demand that were not preloaded</p>
</div></blockquote>
<p><strong>length: int</strong></p>
<blockquote>
<div><p>number of zones in skim to return in skim matrix
in case the skims contain additional external zones that should be trimmed out so skim
array is correct shape to match (flattened) O-D tiled columns in the od dataframe</p>
</div></blockquote>
<p><strong>transpose: bool</strong></p>
<blockquote class="last">
<div><p>whether to transpose the matrix before flattening. (i.e. act as a D-O instead of O-D skim)</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.accessibility.compute_accessibility">
<code class="descclassname">activitysim.defaults.models.accessibility.</code><code class="descname">compute_accessibility</code><span class="sig-paren">(</span><em>settings</em>, <em>accessibility_spec</em>, <em>accessibility_settings</em>, <em>skims</em>, <em>omx_file</em>, <em>land_use</em>, <em>trace_od</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.accessibility.compute_accessibility" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute accessibility for each zone in land use file using expressions from accessibility_spec</p>
<p>The actual results depend on the expressions in accessibility_spec, but this is initially
intended to permit implementation of the mtc accessibility calculation as implemented by
Accessibility.job</p>
<p>Compute measures of accessibility used by the automobile ownership model.
The accessibility measure first multiplies an employment variable by a mode-specific decay
function.  The product reflects the difficulty of accessing the activities the farther
(in terms of round-trip travel time) the jobs are from the location in question. The products
to each destination zone are next summed over each origin zone, and the logarithm of the
product mutes large differences.  The decay function on the walk accessibility measure is
steeper than automobile or transit.  The minimum accessibility is zero.</p>
</dd></dl>

</div>
</div>
<div class="section" id="auto-ownership">
<h2>Auto Ownership<a class="headerlink" href="#auto-ownership" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the auto ownership model is the
<code class="xref py py-func docutils literal"><span class="pre">auto_ownership_simulate()</span></code>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;auto_ownership_simulate&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">households</span></code> | Result Field: <code class="docutils literal"><span class="pre">auto_ownership</span></code> | Skims Keys: NA</p>
<div class="section" id="id1">
<h3>API<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.auto_ownership"></span><dl class="function">
<dt id="activitysim.defaults.models.auto_ownership.auto_ownership_simulate">
<code class="descclassname">activitysim.defaults.models.auto_ownership.</code><code class="descname">auto_ownership_simulate</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>households_merged</em>, <em>auto_ownership_spec</em>, <em>auto_ownership_settings</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.auto_ownership.auto_ownership_simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Auto ownership is a standard model which predicts how many cars a household
with given characteristics owns</p>
</dd></dl>

</div>
</div>
<div class="section" id="coordinated-daily-activity-pattern-cdap">
<span id="cdap"></span><h2>Coordinated Daily Activity Pattern (CDAP)<a class="headerlink" href="#coordinated-daily-activity-pattern-cdap" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the CDAP model is the <a class="reference internal" href="#activitysim.cdap.cdap.run_cdap" title="activitysim.cdap.cdap.run_cdap"><code class="xref py py-func docutils literal"><span class="pre">run_cdap()</span></code></a>
function.  This function is called by the orca step <code class="docutils literal"><span class="pre">cdap_simulate</span></code> which is
registered as an orca step and is called in the example via
<code class="docutils literal"><span class="pre">orca.run([&quot;cdap_simulate&quot;])</span></code>.  There are two cdap class definitions in
ActivitySim.  The first is at <a class="reference internal" href="#module-activitysim.cdap.cdap" title="activitysim.cdap.cdap"><code class="xref py py-func docutils literal"><span class="pre">cdap()</span></code></a> and contains the
core cdap module.  The second is at <a class="reference internal" href="#module-activitysim.defaults.models.cdap" title="activitysim.defaults.models.cdap"><code class="xref py py-func docutils literal"><span class="pre">cdap()</span></code></a> and
contains the orca wrapper for running it as part of the model pipeline.</p>
<p>Core Table: <code class="docutils literal"><span class="pre">persons</span></code> | Result Field: <code class="docutils literal"><span class="pre">cdap_activity</span></code> | Skims Keys: NA</p>
<div class="section" id="id2">
<h3>API<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>cdap<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<span class="target" id="module-activitysim.cdap.cdap"></span><dl class="function">
<dt id="activitysim.cdap.cdap.add_interaction_column">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">add_interaction_column</code><span class="sig-paren">(</span><em>choosers</em>, <em>p_tup</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.add_interaction_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an interaction column in place to choosers, listing the ptypes of the persons in p_tup</p>
<p>The name of the interaction column will be determined by the cdap_ranks from p_tup,
and the rows in the column contain the ptypes of those persons in that household row.</p>
<p>For instance, for p_tup = (1,3) choosers interaction column name will be &#8216;p1_p3&#8217;</p>
<p>For a household where person 1 is part-time worker (ptype=2) and person 3 is infant (ptype 8)
the corresponding row value interaction code will be 28</p>
<p>We take advantage of the fact that interactions are symmetrical to simplify spec expressions:
We name the interaction_column in increasing pnum (cdap_rank) order (p1_p2 and not p3_p1)
And we format row values in increasing ptype order (28 and not 82)
This simplifies the spec expressions as we don&#8217;t have to test for p1_p3 == 28 | p1_p3 == 82</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>choosers</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>household choosers, indexed on _hh_index_
choosers should contain columns ptype_p1, ptype_p2 for each cdap_rank person in hh</p>
</div></blockquote>
<p><strong>p_tup</strong> : int tuple</p>
<blockquote class="last">
<div><p>tuple specifying the cdap_ranks for the interaction column
p_tup = (1,3) means persons with cdap_rank 1 and 3</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.add_pn">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">add_pn</code><span class="sig-paren">(</span><em>col</em>, <em>pnum</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.add_pn" title="Permalink to this definition">¶</a></dt>
<dd><p>return the canonical column name for the indiv_util column or columns
in merged hh_chooser df for individual with cdap_rank pnum</p>
<p>e.g. M_p1, ptype_p2 but leave _hh_id_ column unchanged</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.assign_cdap_rank">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">assign_cdap_rank</code><span class="sig-paren">(</span><em>persons</em>, <em>trace_hh_id=None</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.assign_cdap_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign an integer index, cdap_rank, to each household member. (Starting with 1, not 0)</p>
<p>Modifies persons df in place</p>
<p>The cdap_rank order is important, because cdap only assigns activities to the first
MAX_HHSIZE persons in each household.</p>
<p>This will preferentially be two working adults and the three youngest children.</p>
<p>Rank is assigned starting at 1. This necessitates some care indexing, but is preferred as
it follows the convention of 1-based pnums in expression files.</p>
<p>According to the documentation of reOrderPersonsForCdap in mtctm2.abm.ctramp
HouseholdCoordinatedDailyActivityPatternModel:</p>
<p>&#8220;Method reorders the persons in the household for use with the CDAP model,
which only explicitly models the interaction of five persons in a HH. Priority
in the reordering is first given to full time workers (up to two), then to
part time workers (up to two workers, of any type), then to children (youngest
to oldest, up to three). If the method is called for a household with less
than 5 people, the cdapPersonArray is the same as the person array.&#8221;</p>
<p>We diverge from the above description in that a cdap_rank is assigned to all persons,
including &#8216;extra&#8217; householld members, whose activity is assigned subsequently.
The pair _hh_id_, _cdap_rank_ will uniquely identify each household member.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>persons</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Table of persons data. Must contain columns _hh_size_, _hh_id_, _ptype_, _age_</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>cdap_rank</strong> : pandas.Series</p>
<blockquote class="last">
<div><p>integer cdap_rank of every person, indexed on _persons_index_</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.build_cdap_spec">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">build_cdap_spec</code><span class="sig-paren">(</span><em>interaction_coefficients</em>, <em>hhsize</em>, <em>trace_spec=False</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.build_cdap_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a spec file for computing utilities of alternative household member interaction patterns
for households of specified size.</p>
<p>We generate this spec automatically from a table of rules and coefficients because the
interaction rulkes are fairly simple and can be expressed compactly whereas
there is a lot of redundancy between the spec files for different household sizes, as well as
in the vectorized expression of the interaction alternatives within the spec file itself</p>
<dl class="docutils">
<dt>interaction_coefficients has five columns:</dt>
<dd><dl class="first last docutils">
<dt>activity</dt>
<dd>A single character activity type name (M, N, or H)</dd>
<dt>interaction_ptypes</dt>
<dd>List of ptypes in the interaction (in order of increasing ptype) or empty for wildcards
(meaning that the interaction applies to all ptypes in that size hh)</dd>
<dt>cardinality</dt>
<dd>the number of persons in the interaction (e.g. 3 for a 3-way interaction)</dd>
<dt>slug</dt>
<dd>a human friendly efficient name so we can dump a readable spec trace file for debugging
this slug is replaced with the numerical coefficient value after we dump the trace file</dd>
<dt>coefficient</dt>
<dd>The coefficient to apply for all hh interactions for this activity and set of ptypes</dd>
</dl>
</dd>
</dl>
<p>The generated spec will have the eval expression in the index, and a utility column for each
alternative (e.g. [&#8216;HH&#8217;, &#8216;HM&#8217;, &#8216;HN&#8217;, &#8216;MH&#8217;, &#8216;MM&#8217;, &#8216;MN&#8217;, &#8216;NH&#8217;, &#8216;NM&#8217;, &#8216;NN&#8217;] for hhsize 2)</p>
<p>In order to be able to dump the spec in a human-friendly fashion to facilitate debugging the
cdap_interaction_coefficients table, we first populate utility columns in the spec file
with the coefficient slugs, dump the spec file, and then replace the slugs with coefficients.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>interaction_coefficients</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Rules and coefficients for generating interaction specs for different household sizes</p>
</div></blockquote>
<p><strong>hhsize</strong> : int</p>
<blockquote>
<div><p>household size for which the spec should be built.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">spec: pandas.DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.extra_hh_member_choices">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">extra_hh_member_choices</code><span class="sig-paren">(</span><em>persons</em>, <em>cdap_fixed_relative_proportions</em>, <em>locals_d</em>, <em>trace_hh_id</em>, <em>trace_label</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.extra_hh_member_choices" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate the activity choices for the &#8216;extra&#8217; household members who weren&#8217;t handled by cdap</p>
<p>Following the CTRAMP HouseholdCoordinatedDailyActivityPatternModel, &#8220;a separate,
simple cross-sectional distribution is looked up for the remaining household members&#8221;</p>
<p>The cdap_fixed_relative_proportions spec is handled like an activitysim logit utility spec,
EXCEPT that the values computed are relative proportions, not utilities
(i.e. values are not exponentiated before being normalized to probabilities summing to 1.0)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>persons</strong> : pandas.DataFrame</p>
<blockquote>
<div><dl class="docutils">
<dt>Table of persons data indexed on _persons_index_</dt>
<dd><p class="first last">We expect, at least, columns [_hh_id_, _ptype_]</p>
</dd>
</dl>
</div></blockquote>
<p><strong>cdap_fixed_relative_proportions</strong></p>
<blockquote>
<div><p>spec to compute/specify the relative proportions of each activity (M, N, H)
that should be used to choose activities for additional household members
not handled by CDAP.</p>
</div></blockquote>
<p><strong>locals_d</strong> : Dict</p>
<blockquote>
<div><p>dictionary of local variables that eval_variables adds to the environment
for an evaluation of an expression that begins with &#64;</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>choices</strong> : pandas.Series</p>
<blockquote class="last">
<div><p>list of alternatives chosen for all extra members, indexed by _persons_index_</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.hh_choosers">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">hh_choosers</code><span class="sig-paren">(</span><em>indiv_utils</em>, <em>hhsize</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.hh_choosers" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a chooser table for calculating house utilities for all households of specified hhsize</p>
<p>The choosers table will have one row per household with columns containing the indiv_utils
for all non-extra (i.e. cdap_rank &lt;- MAX_HHSIZE) persons. That makes 3 columns for each
individual. e.g. the utilities of person with cdap_rank 1 will be included as M_p1, N_p1, H_p1</p>
<p>The chooser table will also contain interaction columns for all possible interactions involving
from 2 to 3 persons (actually MAX_INTERACTION_CARDINALITY, which is currently 3).</p>
<p>The interaction columns list the ptypes of the persons in the interaction set, sorted by ptype.
For instance the interaction between persons with cdap_rank 1 and three and ptypes will
be listed in a column named &#8216;p1_p3&#8217; and for a household where persons p1 and p3 are 2 and 4
will a row value of 24 in the p1_p3 column.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>indiv_utils</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>CDAP utilities for each individual, ignoring interactions.
ind_utils has index of _persons_index_ and a column for each alternative
i.e. three columns &#8216;M&#8217; (Mandatory), &#8216;N&#8217; (NonMandatory), &#8216;H&#8217; (Home)</p>
</div></blockquote>
<p><strong>hhsize</strong> : int</p>
<blockquote>
<div><p>household size for which the choosers table should be built. Households with more than
MAX_HHSIZE members will be included with MAX_HHSIZE choosers since the are handled the
same, and the activities of the extra members are assigned afterwards</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>choosers</strong> : pandas.DataFrame</p>
<blockquote class="last">
<div><p>choosers households of hhsize with activity utility columns interaction columns
for all (non-extra) household members</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.household_activity_choices">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">household_activity_choices</code><span class="sig-paren">(</span><em>indiv_utils</em>, <em>interaction_coefficients</em>, <em>hhsize</em>, <em>trace_hh_id=None</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.household_activity_choices" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate household utilities for each activity pattern alternative for households of hhsize
The resulting activity pattern for each household will be coded as a string of activity codes.
e.g. &#8216;MNHH&#8217; for a 4 person household with activities Mandatory, NonMandatory, Home, Home</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>indiv_utils</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>CDAP utilities for each individual, ignoring interactions
ind_utils has index of _persons_index_ and a column for each alternative
i.e. three columns &#8216;M&#8217; (Mandatory), &#8216;N&#8217; (NonMandatory), &#8216;H&#8217; (Home)</p>
</div></blockquote>
<p><strong>interaction_coefficients</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Rules and coefficients for generating interaction specs for different household sizes</p>
</div></blockquote>
<p><strong>hhsize</strong> : int</p>
<blockquote>
<div><p>the size of household for which activity perttern should be calculated (1..MAX_HHSIZE)</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>choices</strong> : pandas.Series</p>
<blockquote class="last">
<div><p>the chosen cdap activity pattern for each household represented as a string (e.g. &#8216;MNH&#8217;)
with same index (_hh_index_) as utils</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.individual_utilities">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">individual_utilities</code><span class="sig-paren">(</span><em>persons</em>, <em>cdap_indiv_spec</em>, <em>locals_d</em>, <em>trace_hh_id=None</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.individual_utilities" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate CDAP utilities for all individuals.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>persons</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>DataFrame of individual persons data.</p>
</div></blockquote>
<p><strong>cdap_indiv_spec</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>CDAP spec applied to individuals.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>utilities</strong> : pandas.DataFrame</p>
<blockquote class="last">
<div><p>Will have index of <cite>persons</cite> and columns for each of the alternatives.
plus some &#8216;useful columns&#8217; [_hh_id_, _ptype_, _cdap_rank_, _hh_size_]</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.preprocess_interaction_coefficients">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">preprocess_interaction_coefficients</code><span class="sig-paren">(</span><em>interaction_coefficients</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.preprocess_interaction_coefficients" title="Permalink to this definition">¶</a></dt>
<dd><p>The input cdap_interaction_coefficients.csv file has three columns:</p>
<dl class="docutils">
<dt>activity</dt>
<dd>A single character activity type name (M, N, or H)</dd>
<dt>interaction_ptypes</dt>
<dd>List of ptypes in the interaction (in order of increasing ptype)
Stars (***) instead of ptypes means the interaction applies to all ptypes in that size hh</dd>
<dt>coefficient</dt>
<dd>The coefficient to apply for all hh interactions for this activity and set of ptypes</dd>
</dl>
<p>To facilitate building the spec for a given hh ssize, we add two additional columns:</p>
<dl class="docutils">
<dt>cardinality</dt>
<dd>the number of persons in the interaction (e.g. 3 for a 3-way interaction)</dd>
<dt>slug</dt>
<dd>a human friendly efficient name so we can dump a readable spec trace file for debugging
this slug is then replaced with the numerical coefficient value prior to evaluation</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.run_cdap">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">run_cdap</code><span class="sig-paren">(</span><em>persons</em>, <em>cdap_indiv_spec</em>, <em>cdap_interaction_coefficients</em>, <em>cdap_fixed_relative_proportions</em>, <em>locals_d</em>, <em>chunk_size=0</em>, <em>trace_hh_id=None</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.run_cdap" title="Permalink to this definition">¶</a></dt>
<dd><p>Choose individual activity patterns for persons.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>persons</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Table of persons data. Must contain at least a household ID, household size,
person type category, and age, plus any columns used in cdap_indiv_spec</p>
</div></blockquote>
<p><strong>cdap_indiv_spec</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>CDAP spec for individuals without taking any interactions into account.</p>
</div></blockquote>
<p><strong>cdap_interaction_coefficients</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Rules and coefficients for generating interaction specs for different household sizes</p>
</div></blockquote>
<p><strong>cdap_fixed_relative_proportions</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Spec to for the relative proportions of each activity (M, N, H)
to choose activities for additional household members not handled by CDAP</p>
</div></blockquote>
<p><strong>locals_d</strong> : Dict</p>
<blockquote>
<div><p>This is a dictionary of local variables that will be the environment
for an evaluation of an expression that begins with &#64;
in either the cdap_indiv_spec or cdap_fixed_relative_proportions expression files</p>
</div></blockquote>
<p><strong>chunk_size: int</strong></p>
<blockquote>
<div><p>Chunk size or 0 for no chunking</p>
</div></blockquote>
<p><strong>trace_hh_id</strong> : int</p>
<blockquote>
<div><p>hh_id to trace or None if no hh tracing</p>
</div></blockquote>
<p><strong>trace_label</strong> : str</p>
<blockquote>
<div><p>label for tracing or None if no tracing</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>choices</strong> : pandas.DataFrame</p>
<blockquote class="last">
<div><p>dataframe is indexed on _persons_index_ and has two columns:</p>
<dl class="docutils">
<dt>cdap_activity</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">str</span><dd><p class="first last">activity for that person expressed as &#8216;M&#8217;, &#8216;N&#8217;, &#8216;H&#8217;</p>
</dd>
<dt>cdap_rank</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">int</span><dd><p class="first last">activities for persons with cdap_rank &lt;= MAX_HHSIZE are determined by cdap
&#8216;extra&#8217; household members activities are assigned by cdap_fixed_relative_proportions</p>
</dd>
</dl>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="activitysim.cdap.cdap.unpack_cdap_indiv_activity_choices">
<code class="descclassname">activitysim.cdap.cdap.</code><code class="descname">unpack_cdap_indiv_activity_choices</code><span class="sig-paren">(</span><em>persons</em>, <em>hh_choices</em>, <em>trace_hh_id</em>, <em>trace_label</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.cdap.cdap.unpack_cdap_indiv_activity_choices" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpack the household activity choice list into choices for each (non-extra) household member</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>persons</strong> : pandas.DataFrame</p>
<blockquote>
<div><p>Table of persons data indexed on _persons_index_
We expect, at least, columns [_hh_id_, _cdap_rank_]</p>
</div></blockquote>
<p><strong>hh_choices</strong> : pandas.Series</p>
<blockquote>
<div><p>household activity pattern is encoded as a string (of length hhsize) of activity codes
e.g. &#8216;MNHH&#8217; for a 4 person household with activities Mandatory, NonMandatory, Home, Home</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>cdap_indiv_activity_choices</strong> : pandas.Series</p>
<blockquote class="last">
<div><p>series contains one activity per individual hh member, indexed on _persons_index_</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-activitysim.defaults.models.cdap">
<span id="models-cdap"></span><h4>models.cdap<a class="headerlink" href="#module-activitysim.defaults.models.cdap" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="activitysim.defaults.models.cdap.cdap_fixed_relative_proportions">
<code class="descclassname">activitysim.defaults.models.cdap.</code><code class="descname">cdap_fixed_relative_proportions</code><span class="sig-paren">(</span><em>configs_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.cdap.cdap_fixed_relative_proportions" title="Permalink to this definition">¶</a></dt>
<dd><p>spec to compute/specify the relative proportions of each activity (M, N, H)
that should be used to choose activities for additional household members
not handled by CDAP</p>
<p>This spec is handled much like an activitysim logit utility spec,
EXCEPT that the values computed are relative proportions, not utilities
(i.e. values are not exponentiated before being normalized to probabilities summing to 1.0)</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.cdap.cdap_indiv_spec">
<code class="descclassname">activitysim.defaults.models.cdap.</code><code class="descname">cdap_indiv_spec</code><span class="sig-paren">(</span><em>configs_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.cdap.cdap_indiv_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>spec to compute the activity utilities for each individual hh member
with no interactions with other household members taken into account</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.cdap.cdap_interaction_coefficients">
<code class="descclassname">activitysim.defaults.models.cdap.</code><code class="descname">cdap_interaction_coefficients</code><span class="sig-paren">(</span><em>configs_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.cdap.cdap_interaction_coefficients" title="Permalink to this definition">¶</a></dt>
<dd><p>Rules and coefficients for generating interaction specs for different household sizes</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.cdap.cdap_settings">
<code class="descclassname">activitysim.defaults.models.cdap.</code><code class="descname">cdap_settings</code><span class="sig-paren">(</span><em>configs_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.cdap.cdap_settings" title="Permalink to this definition">¶</a></dt>
<dd><p>canonical model settings file to permit definition of local constants for by
cdap_indiv_spec and cdap_fixed_relative_proportions</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.cdap.cdap_simulate">
<code class="descclassname">activitysim.defaults.models.cdap.</code><code class="descname">cdap_simulate</code><span class="sig-paren">(</span><em>persons_merged</em>, <em>cdap_settings</em>, <em>cdap_indiv_spec</em>, <em>cdap_interaction_coefficients</em>, <em>cdap_fixed_relative_proportions</em>, <em>hh_chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.cdap.cdap_simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>CDAP stands for Coordinated Daily Activity Pattern, which is a choice of
high-level activity pattern for each person, in a coordinated way with other
members of a person&#8217;s household.</p>
<p>Because Python requires vectorization of computation, there are some specialized
routines in the cdap directory of activitysim for this purpose.  This module
simply applies those utilities using the simulation framework.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="destination-choice">
<h2>Destination Choice<a class="headerlink" href="#destination-choice" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the destination choice model is the
<code class="xref py py-func docutils literal"><span class="pre">destination_choice()</span></code>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;destination_choice&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">tours</span></code> | Result Field: <code class="docutils literal"><span class="pre">destination</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">TAZ,TAZ_r</span></code></p>
<div class="section" id="id4">
<h3>API<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.destination"></span><dl class="function">
<dt id="activitysim.defaults.models.destination.destination_choice">
<code class="descclassname">activitysim.defaults.models.destination.</code><code class="descname">destination_choice</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>non_mandatory_tours_merged</em>, <em>skims</em>, <em>destination_choice_spec</em>, <em>destination_choice_settings</em>, <em>destination_size_terms</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.destination.destination_choice" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the tour generation from the above, each tour needs to have a
destination, so in this case tours are the choosers (with the associated
person that&#8217;s making the tour)</p>
</dd></dl>

<dl class="function">
<dt id="activitysim.defaults.models.destination.patch_mandatory_tour_destination">
<code class="descclassname">activitysim.defaults.models.destination.</code><code class="descname">patch_mandatory_tour_destination</code><span class="sig-paren">(</span><em>mandatory_tours_merged</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.destination.patch_mandatory_tour_destination" title="Permalink to this definition">¶</a></dt>
<dd><p>Patch destination column of mandatory tours with school or workplace taz
to conform to non-mandatory tours naming so that computed columns in the tours
table can use destination for any tour type.</p>
</dd></dl>

</div>
</div>
<div class="section" id="mandatory-scheduling">
<h2>Mandatory Scheduling<a class="headerlink" href="#mandatory-scheduling" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the mandatory tour purpose scheduling model is the
<a class="reference internal" href="#activitysim.defaults.models.mandatory_scheduling.mandatory_scheduling" title="activitysim.defaults.models.mandatory_scheduling.mandatory_scheduling"><code class="xref py py-func docutils literal"><span class="pre">mandatory_scheduling()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;mandatory_scheduling&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">tours</span></code> | Result Field: <code class="docutils literal"><span class="pre">tour_departure_and_duration</span></code> | Skims Keys: NA</p>
<div class="section" id="id5">
<h3>API<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.mandatory_scheduling"></span><dl class="function">
<dt id="activitysim.defaults.models.mandatory_scheduling.mandatory_scheduling">
<code class="descclassname">activitysim.defaults.models.mandatory_scheduling.</code><code class="descname">mandatory_scheduling</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>mandatory_tours_merged</em>, <em>tdd_alts</em>, <em>tdd_school_spec</em>, <em>tdd_work_spec</em>, <em>mandatory_scheduling_settings</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.mandatory_scheduling.mandatory_scheduling" title="Permalink to this definition">¶</a></dt>
<dd><p>This model predicts the departure time and duration of each activity for
mandatory tours</p>
</dd></dl>

</div>
</div>
<div class="section" id="mandatory-tour-frequency">
<h2>Mandatory Tour Frequency<a class="headerlink" href="#mandatory-tour-frequency" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the mandatory tour purpose frequency model is the
<a class="reference internal" href="#activitysim.defaults.models.mandatory_tour_frequency.mandatory_tour_frequency" title="activitysim.defaults.models.mandatory_tour_frequency.mandatory_tour_frequency"><code class="xref py py-func docutils literal"><span class="pre">mandatory_tour_frequency()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;mandatory_tour_frequency&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">persons</span></code> | Result Field: <code class="docutils literal"><span class="pre">mandatory_tour_frequency</span></code> | Skims Keys: NA</p>
<div class="section" id="id6">
<h3>API<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.mandatory_tour_frequency"></span><dl class="function">
<dt id="activitysim.defaults.models.mandatory_tour_frequency.mandatory_tour_frequency">
<code class="descclassname">activitysim.defaults.models.mandatory_tour_frequency.</code><code class="descname">mandatory_tour_frequency</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>persons_merged</em>, <em>mandatory_tour_frequency_spec</em>, <em>mandatory_tour_frequency_settings</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.mandatory_tour_frequency.mandatory_tour_frequency" title="Permalink to this definition">¶</a></dt>
<dd><p>This model predicts the frequency of making mandatory trips (see the
alternatives above) - these trips include work and school in some combination.</p>
</dd></dl>

</div>
</div>
<div class="section" id="mode-tour-and-trip">
<span id="mode-choice"></span><h2>Mode (Tour and Trip)<a class="headerlink" href="#mode-tour-and-trip" title="Permalink to this headline">¶</a></h2>
<p>The trip mode model currently operates on the tour table.  The trip model model repeats the same
operation as the tour mode model, but uses the trip mode expression specification instead.</p>
<div class="section" id="tour">
<h3>Tour<a class="headerlink" href="#tour" title="Permalink to this headline">¶</a></h3>
<p>The main interface to the tour mode model is the
<code class="xref py py-func docutils literal"><span class="pre">_mode_choice_simulate()</span></code>
function.  This function is called in the orca step <code class="docutils literal"><span class="pre">tour_mode_choice_simulate</span></code> and in
the example via <code class="docutils literal"><span class="pre">orca.run([&quot;tour_mode_choice_simulate&quot;])</span></code>.</p>
<p>Core Table: <code class="docutils literal"><span class="pre">tours</span></code> | Result Field: <code class="docutils literal"><span class="pre">mode</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">TAZ,destination</span></code> |
Skims3D in_skims Keys: <code class="docutils literal"><span class="pre">TAZ,destination,in_period</span></code> | Skims3D out_skims Keys: <code class="docutils literal"><span class="pre">destination,TAZ,out_period</span></code></p>
</div>
<div class="section" id="trip">
<h3>Trip<a class="headerlink" href="#trip" title="Permalink to this headline">¶</a></h3>
<p>The main interface to the trip mode model is the
<code class="xref py py-func docutils literal"><span class="pre">_mode_choice_simulate()</span></code>
function.  This function is called in the orca step <code class="docutils literal"><span class="pre">trip_mode_choice_simulate</span></code> and in
the example via <code class="docutils literal"><span class="pre">orca.run([&quot;trip_mode_choice_simulate&quot;])</span></code>.</p>
<p>Core Table: <code class="docutils literal"><span class="pre">trips</span></code> | Result Field: <code class="docutils literal"><span class="pre">mode</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">TAZ,destination</span></code>
Skims3D in_skims Keys: <code class="docutils literal"><span class="pre">TAZ,destination,in_period</span></code> | Skims3D out_skims Keys: <code class="docutils literal"><span class="pre">destination,TAZ,out_period</span></code></p>
</div>
<div class="section" id="id7">
<h3>API<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.mode"></span><dl class="function">
<dt id="activitysim.defaults.models.mode.get_segment_and_unstack">
<code class="descclassname">activitysim.defaults.models.mode.</code><code class="descname">get_segment_and_unstack</code><span class="sig-paren">(</span><em>omnibus_spec</em>, <em>segment</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.mode.get_segment_and_unstack" title="Permalink to this definition">¶</a></dt>
<dd><p>This does what it says.  Take the spec, get the column from the spec for
the given segment, and unstack.  It is assumed that the last column of
the multiindex is alternatives so when you do this unstacking,
each alternative is in a column (which is the format this as used for the
simple_simulate call.  The weird nuance here is the &#8220;Rowid&#8221; column -
since many expressions are repeated (e.g. many are just &#8220;1&#8221;) a Rowid
column is necessary to identify which alternatives are actually part of
which original row - otherwise the unstack is incorrect (i.e. the index
is not unique)</p>
</dd></dl>

<dl class="data">
<dt id="activitysim.defaults.models.mode.logger">
<code class="descclassname">activitysim.defaults.models.mode.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#activitysim.defaults.models.mode.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Mode choice is run for all tours to determine the transportation mode that
will be used for the tour</p>
</dd></dl>

</div>
</div>
<div class="section" id="non-mandatory-scheduling">
<h2>Non-Mandatory Scheduling<a class="headerlink" href="#non-mandatory-scheduling" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the non-mandatory scheduling model is the
<a class="reference internal" href="#activitysim.defaults.models.non_mandatory_scheduling.non_mandatory_scheduling" title="activitysim.defaults.models.non_mandatory_scheduling.non_mandatory_scheduling"><code class="xref py py-func docutils literal"><span class="pre">non_mandatory_scheduling()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;non_mandatory_scheduling&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">tours</span></code> | Result Field: <code class="docutils literal"><span class="pre">tour_departure_and_duration</span></code> | Skims Keys: NA</p>
<div class="section" id="id8">
<h3>API<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.non_mandatory_scheduling"></span><dl class="function">
<dt id="activitysim.defaults.models.non_mandatory_scheduling.non_mandatory_scheduling">
<code class="descclassname">activitysim.defaults.models.non_mandatory_scheduling.</code><code class="descname">non_mandatory_scheduling</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>non_mandatory_tours_merged</em>, <em>tdd_alts</em>, <em>tdd_non_mandatory_spec</em>, <em>non_mandatory_scheduling_settings</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.non_mandatory_scheduling.non_mandatory_scheduling" title="Permalink to this definition">¶</a></dt>
<dd><p>This model predicts the departure time and duration of each activity for
non-mandatory tours</p>
</dd></dl>

</div>
</div>
<div class="section" id="non-mandatory-tour-frequency">
<h2>Non-Mandatory Tour Frequency<a class="headerlink" href="#non-mandatory-tour-frequency" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the non-mandatory tour frequency model is the
<a class="reference internal" href="#activitysim.defaults.models.non_mandatory_tour_frequency.non_mandatory_tour_frequency" title="activitysim.defaults.models.non_mandatory_tour_frequency.non_mandatory_tour_frequency"><code class="xref py py-func docutils literal"><span class="pre">non_mandatory_tour_frequency()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;non_mandatory_tour_frequency&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">persons</span></code> | Result Field: <code class="docutils literal"><span class="pre">persons_nmtf</span></code> | Skims Keys: NA</p>
<div class="section" id="id9">
<h3>API<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.non_mandatory_tour_frequency"></span><dl class="function">
<dt id="activitysim.defaults.models.non_mandatory_tour_frequency.non_mandatory_tour_frequency">
<code class="descclassname">activitysim.defaults.models.non_mandatory_tour_frequency.</code><code class="descname">non_mandatory_tour_frequency</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>persons_merged</em>, <em>non_mandatory_tour_frequency_alts</em>, <em>non_mandatory_tour_frequency_spec</em>, <em>non_mandatory_tour_frequency_settings</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.non_mandatory_tour_frequency.non_mandatory_tour_frequency" title="Permalink to this definition">¶</a></dt>
<dd><p>This model predicts the frequency of making non-mandatory trips
(alternatives for this model come from a separate csv file which is
configured by the user) - these trips include escort, shopping, othmaint,
othdiscr, eatout, and social trips in various combination.</p>
</dd></dl>

</div>
</div>
<div class="section" id="school-location">
<h2>School Location<a class="headerlink" href="#school-location" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the school location model is the
<a class="reference internal" href="#activitysim.defaults.models.school_location.school_location_simulate" title="activitysim.defaults.models.school_location.school_location_simulate"><code class="xref py py-func docutils literal"><span class="pre">school_location_simulate()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;school_location_simulate&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">persons</span></code> | Result Field: <code class="docutils literal"><span class="pre">school_taz</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">TAZ,TAZ_r</span></code></p>
<div class="section" id="id10">
<h3>API<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.school_location"></span><dl class="function">
<dt id="activitysim.defaults.models.school_location.school_location_simulate">
<code class="descclassname">activitysim.defaults.models.school_location.</code><code class="descname">school_location_simulate</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>persons_merged</em>, <em>school_location_spec</em>, <em>school_location_settings</em>, <em>skims</em>, <em>destination_size_terms</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.school_location.school_location_simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>The school location model predicts the zones in which various people will
go to school.</p>
</dd></dl>

</div>
</div>
<div class="section" id="workplace-location">
<h2>Workplace Location<a class="headerlink" href="#workplace-location" title="Permalink to this headline">¶</a></h2>
<p>The main interface to the workplace location model is the
<a class="reference internal" href="#activitysim.defaults.models.workplace_location.workplace_location_simulate" title="activitysim.defaults.models.workplace_location.workplace_location_simulate"><code class="xref py py-func docutils literal"><span class="pre">workplace_location_simulate()</span></code></a>
function.  This function is registered as an orca step and is called in the example
via <code class="docutils literal"><span class="pre">orca.run([&quot;workplace_location_simulate&quot;])</span></code></p>
<p>Core Table: <code class="docutils literal"><span class="pre">persons</span></code> | Result Field: <code class="docutils literal"><span class="pre">workplace_taz</span></code> | Skims Keys: <code class="docutils literal"><span class="pre">TAZ,TAZ_r</span></code></p>
<div class="section" id="id11">
<h3>API<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-activitysim.defaults.models.workplace_location"></span><dl class="function">
<dt id="activitysim.defaults.models.workplace_location.workplace_location_simulate">
<code class="descclassname">activitysim.defaults.models.workplace_location.</code><code class="descname">workplace_location_simulate</code><span class="sig-paren">(</span><em>set_random_seed</em>, <em>persons_merged</em>, <em>workplace_location_spec</em>, <em>workplace_location_settings</em>, <em>skims</em>, <em>destination_size_terms</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#activitysim.defaults.models.workplace_location.workplace_location_simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>The workplace location model predicts the zones in which various people will
work.</p>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="development.html" class="btn btn-neutral float-right" title="Development" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="core.html" class="btn btn-neutral" title="Core Utilities" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright contributing authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>