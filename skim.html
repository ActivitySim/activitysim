

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Skim Abstractions &mdash; ActivitySim 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ActivitySim 0.1 documentation" href="index.html"/>
        <link rel="next" title="CDAP" href="cdap.html"/>
        <link rel="prev" title="Core Utilities" href="core.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> ActivitySim</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="core.html#module-activitysim.activitysim">API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Skim Abstractions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-activitysim.skim">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cdap.html">CDAP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cdap.html#module-activitysim.cdap.cdap">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mnl.html">MNL Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mnl.html#module-activitysim.mnl">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Internal Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="util.html#module-activitysim.util.reindex">Reindex</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html#module-activitysim.util.testing">Testing</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ActivitySim</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Skim Abstractions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/skim.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="skim-abstractions">
<h1>Skim Abstractions<a class="headerlink" href="#skim-abstractions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-activitysim.skim">
<span id="api"></span><h2>API<a class="headerlink" href="#module-activitysim.skim" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="activitysim.skim.Skim">
<em class="property">class </em><tt class="descclassname">activitysim.skim.</tt><tt class="descname">Skim</tt><big>(</big><em>data</em>, <em>offset=None</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skim" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for skim arrays.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> : 2D array</p>
<p><strong>offset</strong> : int, optional</p>
<blockquote class="last">
<div><p>An optional offset that will be added to origin/destination
values to turn them into array indices.
For example, if zone IDs are 1-based, an offset of -1
would turn them into 0-based array indices.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="activitysim.skim.Skim.get">
<tt class="descname">get</tt><big>(</big><em>orig</em>, <em>dest</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skim.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get impedence values for a set of origin, destination pairs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>orig</strong> : 1D array</p>
<p><strong>dest</strong> : 1D array</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>values</strong> : 1D array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="activitysim.skim.Skims">
<em class="property">class </em><tt class="descclassname">activitysim.skim.</tt><tt class="descname">Skims</tt><a class="headerlink" href="#activitysim.skim.Skims" title="Permalink to this definition">¶</a></dt>
<dd><p>A skims object is a wrapper around multiple skim objects,
where each object is identified by a key.  It operates like a
dictionary - i.e. use brackets to add and get skim objects - but also
has information on how to lookup against the skim objects.
Specifically, this object has a dataframe, a left_key and right_key.
It is assumed that left_key and right_key identify columns in df.  The
parameter df is usually set by the simulation itself as it&#8217;s a result of
interacting choosers and alternatives.</p>
<p>When the user calls skims[key], key is an identifier for which skim
to use, and the object automatically looks up impedances of that skim
using the specified left_key column in df as the origin and
the right_key column in df as the destination.  In this way, the user
does not do the O-D lookup by hand and only specifies which skim to use
for this lookup.  This is the only purpose of this object: to
abstract away the O-D lookup and use skims by specifying which skim
to use in the expressions.</p>
<p>Note that keys are any hashable object, not just strings.  So calling
skim[(&#8216;AM&#8217;, &#8216;SOV&#8217;)] is valid and useful.</p>
<dl class="method">
<dt id="activitysim.skim.Skims.get_3d">
<tt class="descname">get_3d</tt><big>(</big><em>key</em>, <em>key_3d</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims.get_3d" title="Permalink to this definition">¶</a></dt>
<dd><p>If you want</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>key</strong> : String or any hashable</p>
<blockquote>
<div><p>Will be accessible using __getitem__ in Skims3d</p>
</div></blockquote>
<p><strong>key_3d</strong> : String or any hashable</p>
<blockquote>
<div><p>Relates to the 3rd dimension lookup column set by Skims3D</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>skims</strong> : Skim</p>
<blockquote class="last">
<div><p>the skim object for these keys</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="activitysim.skim.Skims.lookup">
<tt class="descname">lookup</tt><big>(</big><em>skim</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Generally not called by the user - use __getitem__ instead</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>skim: Skim</strong></p>
<blockquote>
<div><p>The skim object to perform the lookup using df[left_key] as the
origin and df[right_key] as the destination</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">impedances: pd.Series</p>
<blockquote class="last">
<div><p>A Series of impedances which are elements of the Skim object and
with the same index as df</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="activitysim.skim.Skims.set_3d">
<tt class="descname">set_3d</tt><big>(</big><em>key</em>, <em>key_3d</em>, <em>value</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims.set_3d" title="Permalink to this definition">¶</a></dt>
<dd><p>If you want to use the Skims3D object below, you will need to do that
explicitly by setting first the key which will be used by __getattr__
and second the key that relates to the 3rd dimension of the dataframe.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>key</strong> : String or any hashable</p>
<blockquote>
<div><p>Will be accessible using __getitem__ in Skims3d</p>
</div></blockquote>
<p><strong>key_3d</strong> : String or any hashable</p>
<blockquote>
<div><p>Relates to the 3rd dimension lookup column set by Skims3D</p>
</div></blockquote>
<p><strong>value</strong> : Skim</p>
<blockquote class="last">
<div><p>the skim object for these keys</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="activitysim.skim.Skims.set_df">
<tt class="descname">set_df</tt><big>(</big><em>df</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims.set_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the dataframe</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>df</strong> : DataFrame</p>
<blockquote>
<div><p>The dataframe which contains the origin and destination ids</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="activitysim.skim.Skims.set_keys">
<tt class="descname">set_keys</tt><big>(</big><em>left_key</em>, <em>right_key</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims.set_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the left and right keys.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>left_key</strong> : String</p>
<blockquote>
<div><p>The left key (origin) column in the dataframe</p>
</div></blockquote>
<p><strong>right_key</strong> : String</p>
<blockquote>
<div><p>The right key (destination) column in the dataframe</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="activitysim.skim.Skims3D">
<em class="property">class </em><tt class="descclassname">activitysim.skim.</tt><tt class="descname">Skims3D</tt><big>(</big><em>skims</em>, <em>skim_key</em>, <em>offset=None</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims3D" title="Permalink to this definition">¶</a></dt>
<dd><p>A 3DSkims object wraps a skim objects to add an additional wrinkle of
lookup functionality.  Upon init the separate skims objects are
processed into a 3D matrix so that lookup of the different skims can
be performed quickly for each row in the dataframe.  In this very
particular formulation, the keys are assumed to be tuples with two
elements - the second element of which will be taken from the
different rows in the dataframe.  The first element can then be
dereferenced like an array.  This is useful, for instance, to have a
certain skim vary by time of day - the skims are set with keys of
(&#8216;SOV&#8217;, &#8216;AM&#8221;), (&#8216;SOV&#8217;, &#8216;PM&#8217;) etc.  The time of day is then taken to
be different for every row in the tours table, and the &#8216;SOV&#8217; portion
of the key can be used in __getitem__.</p>
<p>To be more explicit, the input is a dictionary of Skims objects, each of
which contains a 2D matrix.  These are stacked into a 3D matrix with a
mapping of keys to indexes which is applied using pandas .map to a third
column in the object dataframe.  The three columns - left_key and
right_key from the Skims object and skim_key from this one, are then used to
dereference the 3D matrix.  The tricky part comes in defining the key which
matches the 3rd dimension of the matrix, and the key which is passed into
__getitem__ below (i.e. the one used in the specs).  By convention,
every key in the Skims object that is passed in MUST be a tuple with 2
items.  The second item in the tuple maps to the items in the dataframe
referred to by the skim_key column and the first item in the tuple is
then available to pass directly to __getitem__.  This is now made
explicit by adding the set_3d and get_3d methods in the Skims object which
take the two keys independently and convert to the tuple internally.
The sum conclusion of this is that in the specs, you can say something
like out_skim[&#8216;SOV&#8217;] and it will automatically dereference the 3D matrix
using origin, destination, and time of day.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>skims: Skims</strong></p>
<blockquote>
<div><p>This is the Skims object to wrap</p>
</div></blockquote>
<p><strong>skim_key</strong> : str</p>
<blockquote>
<div><p>This identifies the column in the dataframe which is used to
select among Skim object using the SECOND item in each tuple (see
above for a more complete description)</p>
</div></blockquote>
<p><strong>offset</strong> : int, optional</p>
<blockquote class="last">
<div><p>A single offset must be used for all Skim objects - previous
offsets will be ignored</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="activitysim.skim.Skims3D.lookup">
<tt class="descname">lookup</tt><big>(</big><em>key</em>, <em>origins</em>, <em>destinations</em>, <em>skim_indexes</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims3D.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Generally not called by the user - use __getitem__ instead</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>key</strong> : String</p>
<p><strong>origins</strong> : Series</p>
<blockquote>
<div><p>Identifies the origins of trips as indexes</p>
</div></blockquote>
<p><strong>destinations</strong> : Series</p>
<blockquote>
<div><p>Identifies the destinations of trips as indexes</p>
</div></blockquote>
<p><strong>skim_index</strong> : Series</p>
<blockquote>
<div><p>Identifies the indexes of the skims so that different skims can
be used for different rows</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">impedances: pd.Series</p>
<blockquote class="last">
<div><p>A Series of impedances which are elements of the Skim object and
with the same index as df</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="activitysim.skim.Skims3D.set_df">
<tt class="descname">set_df</tt><big>(</big><em>df</em><big>)</big><a class="headerlink" href="#activitysim.skim.Skims3D.set_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the dataframe</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>df</strong> : DataFrame</p>
<blockquote>
<div><p>The dataframe which contains the origin and destination ids</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cdap.html" class="btn btn-neutral float-right" title="CDAP">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="core.html" class="btn btn-neutral" title="Core Utilities"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Autodesk.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>